<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Michael Qiu | Workspace Architect</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    colors: {
                        'klein-blue': '#002FA7',
                        'neon-green': '#17f700',
                        'bg-dark': '#050505',
                        'bg-light': '#F2F2F7', 
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        display: ['Syncopate', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'float': 'float 6s ease-in-out infinite',
                        'spin-slow': 'spin 120s linear infinite',
                        'marquee': 'marquee 30s linear infinite',
                        'marquee-reverse': 'marqueeReverse 35s linear infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        marquee: {
                            '0%': { transform: 'translateX(0%)' },
                            '100%': { transform: 'translateX(-100%)' },
                        },
                        marqueeReverse: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0%)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <!-- Lenis (Smooth Scroll) -->
    <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&family=JetBrains+Mono:wght@400;700&family=Syncopate:wght@700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --klein-blue: #002FA7;
            --klein-blue-glow: rgba(0, 47, 167, 0.6);
            /* Refined Dark Gradient */
            --bg-gradient-dark: radial-gradient(circle at 50% 30%, #00154a 0%, #020b26 40%, #000000 100%); 
            --bg-gradient-light: radial-gradient(circle at 50% 50%, #ffffff 0%, #F2F2F7 100%);
        }

        body {
            background: var(--bg-gradient-light);
            color: #111;
            transition: background 0.5s ease, color 0.5s ease;
        }

        html.dark body {
            background: var(--bg-gradient-dark);
            color: #ffffff;
        }

        /* Lenis */
        html.lenis { height: auto; }
        .lenis.lenis-smooth { scroll-behavior: auto; }
        .lenis.lenis-smooth [data-lenis-prevent] { overscroll-behavior: contain; }
        .lenis.lenis-stopped { overflow: hidden; }
        .lenis.lenis-scrolling iframe { pointer-events: none; }

        /* Custom Cursor */
        @media (hover: hover) and (pointer: fine) {
            body { cursor: none !important; }
            .cursor-dot, .cursor-outline { display: block; }
        }
        .cursor-dot, .cursor-outline {
            position: fixed; top: 0; left: 0;
            transform: translate(-50%, -50%); border-radius: 50%;
            z-index: 20000; pointer-events: none; mix-blend-mode: difference;
        }
        .cursor-dot { width: 8px; height: 8px; background-color: white; }
        .cursor-outline { width: 40px; height: 40px; border: 1px solid white; transition: width 0.2s, height 0.2s; }
        body:hover .cursor-outline { width: 30px; height: 30px; }

        /* Visual Noise */
        .grain-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; 
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.15'/%3E%3C/svg%3E");
            opacity: 0.3; mix-blend-mode: overlay;
        }

        /* Typography */
        .outline-text { color: transparent; -webkit-text-stroke: 1px rgba(0, 0, 0, 0.8); }
        html.dark .outline-text { -webkit-text-stroke: 2px rgba(255, 255, 255, 0.8); }
        
        .glitch-wrapper { position: relative; }
        .glitch-wrapper::before, .glitch-wrapper::after {
            content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: transparent;
        }
        .glitch-wrapper::before { left: 3px; text-shadow: -2px 0 #ff00c1; clip: rect(44px, 450px, 56px, 0); animation: glitch-anim 3s infinite linear alternate-reverse; }
        .glitch-wrapper::after { left: -3px; text-shadow: -2px 0 #00fff9; clip: rect(44px, 450px, 56px, 0); animation: glitch-anim2 3s infinite linear alternate-reverse; }
        @keyframes glitch-anim { 0% { clip: rect(3px, 9999px, 11px, 0); } 100% { clip: rect(22px, 9999px, 76px, 0); } }
        @keyframes glitch-anim2 { 0% { clip: rect(65px, 9999px, 92px, 0); } 100% { clip: rect(35px, 9999px, 12px, 0); } }

        /* Glass Cards */
        .glass-card { background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(0, 0, 0, 0.1); transition: all 0.3s ease; }
        html.dark .glass-card { background: rgba(20, 20, 20, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-card:hover { border-color: var(--klein-blue); background: rgba(0, 47, 167, 0.05); }

        /* Marquee */
        .marquee-container { overflow: hidden; white-space: nowrap; display: flex; }
        .marquee-content { display: flex; flex-shrink: 0; }
        .animate-marquee { animation: marquee 20s linear infinite; }
        .animate-marquee-reverse { animation: marqueeReverse 25s linear infinite; }

        /* Sidebar */
        .sidebar-enter-active, .sidebar-leave-active { transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1); }
        .sidebar-enter-from, .sidebar-leave-to { transform: translateX(-100%); }
        .backdrop-enter-active, .backdrop-leave-active { transition: opacity 0.4s ease; }
        .backdrop-enter-from, .backdrop-leave-to { opacity: 0; }

        /* Loader */
        .loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 20000; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        
        .capsule-nav { transition: width 0.3s ease, background-color 0.3s ease; }

        /* Mask Gradient */
        .mask-fade-edges {
            mask-image: linear-gradient(to right, transparent 0%, black 15%, black 85%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 15%, black 85%, transparent 100%);
        }

        .logo-svg { fill: currentColor; }
        .magnetic-ball line { stroke: currentColor; stroke-width: 1.5; opacity: 0.4; }
    </style>
</head>
<body>
    <div id="app" class="relative min-h-screen selection:bg-[#002FA7] selection:text-white">
        
        <div class="cursor-dot hidden md:block"></div>
        <div class="cursor-outline hidden md:block"></div>
        <div class="grain-overlay"></div>

        <div class="loader" ref="loader">
            <div class="flex items-end gap-1 mb-4">
                <div class="w-2 h-8 bg-white animate-bounce" style="animation-delay: 0s"></div>
                <div class="w-2 h-12 bg-klein-blue animate-bounce" style="animation-delay: 0.1s"></div>
                <div class="w-2 h-6 bg-white animate-bounce" style="animation-delay: 0.2s"></div>
            </div>
            <div class="font-mono text-sm tracking-[0.3em] text-white">SYSTEM_BOOT</div>
        </div>

        <!-- Navigation Bar (Improved Contrast) -->
        <nav class="fixed top-0 left-0 w-full z-[9990] px-8 py-8 flex justify-between items-center pointer-events-none transition-colors duration-500">
            <!-- Left: Sidebar Trigger -->
            <button @click="toggleSidebar" class="group flex items-center gap-4 focus:outline-none pointer-events-auto text-black dark:text-white">
                <div class="relative w-12 h-12 border-2 border-current rounded-full flex flex-col justify-center items-center gap-1.5 overflow-hidden backdrop-blur-sm group-hover:border-klein-blue group-hover:text-klein-blue transition-all duration-300 bg-white/10 dark:bg-black/10">
                    <span class="w-5 h-0.5 bg-current transition-all duration-300 group-hover:w-8"></span>
                    <span class="w-8 h-0.5 bg-current transition-all duration-300 group-hover:w-5"></span>
                </div>
            </button>
            
            <!-- Center: Progress Capsule (Higher Contrast Background) -->
            <div class="absolute left-1/2 -translate-x-1/2 pointer-events-auto">
                <div class="relative group cursor-pointer" @click="toggleCapsuleNav">
                    <div class="bg-white/80 dark:bg-black/60 backdrop-blur-xl border border-black/10 dark:border-white/20 rounded-full h-12 flex items-center justify-center transition-all duration-500 overflow-hidden shadow-2xl text-black dark:text-white hover:bg-white/90 dark:hover:bg-black/70"
                         :class="isCapsuleOpen ? 'w-[360px]' : 'w-[160px]'">
                        
                        <div v-if="!isCapsuleOpen" class="font-mono text-xs font-bold tracking-[0.2em] px-6 animate-fade-in">
                            {{ activeSection.toUpperCase() }}
                        </div>

                        <div v-else class="flex gap-6 font-mono text-[10px] font-bold text-gray-900 dark:text-gray-100 px-6 animate-fade-in whitespace-nowrap">
                            <a href="#home" class="hover:text-klein-blue transition-colors">HOME</a>
                            <span>/</span>
                            <a href="#profile" class="hover:text-klein-blue transition-colors">PROFILE</a>
                            <span>/</span>
                            <a href="#works" class="hover:text-klein-blue transition-colors">WORKS</a>
                            <span>/</span>
                            <a href="#connect" class="hover:text-klein-blue transition-colors">CONNECT</a>
                        </div>
                    </div>

                    <svg class="absolute top-0 left-0 w-full h-full pointer-events-none" style="overflow: visible;">
                        <rect x="0" y="0" width="100%" height="100%" rx="24" ry="24" 
                              fill="none" stroke="transparent" stroke-width="2" />
                         <rect x="0" y="0" width="100%" height="100%" rx="24" ry="24" 
                              fill="none" stroke="#002FA7" stroke-width="4"
                              :stroke-dasharray="capsulePerimeter"
                              :stroke-dashoffset="capsuleDashOffset"
                              style="transition: stroke-dashoffset 0.1s linear, stroke-dasharray 0.5s ease;" />
                    </svg>
                </div>
            </div>

            <!-- Right: Theme Toggle -->
            <div class="flex items-center gap-6 pointer-events-auto text-black dark:text-white">
                <button @click="cycleTheme" class="hover:text-klein-blue hover:rotate-180 transition-all duration-500 focus:outline-none flex items-center justify-center w-10 h-10 rounded-full border border-transparent hover:border-current bg-white/10 dark:bg-black/10">
                    <span v-show="themeMode === 'light'" class="animate-fade-in"><i data-lucide="sun" class="w-6 h-6"></i></span>
                    <span v-show="themeMode === 'dark'" class="animate-fade-in"><i data-lucide="moon" class="w-6 h-6"></i></span>
                    <span v-show="themeMode === 'auto'" class="animate-fade-in"><i data-lucide="monitor" class="w-6 h-6"></i></span>
                </button>
            </div>
        </nav>

        <!-- Sidebar Overlay -->
        <transition name="backdrop">
            <div v-if="isSidebarOpen" @click="toggleSidebar" class="fixed inset-0 bg-black/60 backdrop-blur-md z-[9995]"></div>
        </transition>

        <!-- Sidebar -->
        <transition name="sidebar">
            <aside v-if="isSidebarOpen" class="fixed top-0 left-0 w-full md:w-[40vw] h-full bg-[#F2F2F7] dark:bg-[#080808] text-black dark:text-white z-[10000] border-r border-gray-200 dark:border-white/10 flex flex-col pl-8 pr-8 md:pl-16 md:pr-16 shadow-[0_0_50px_rgba(0,0,0,0.5)] overflow-y-auto overflow-x-hidden">
                <button @click="toggleSidebar" class="absolute top-8 left-8 md:left-12 w-12 h-12 flex items-center justify-center border-2 border-gray-200 dark:border-white/10 rounded-full hover:border-klein-blue hover:text-white hover:bg-klein-blue transition-all duration-300">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
                <div class="absolute top-0 right-0 w-full h-full overflow-hidden opacity-10 pointer-events-none">
                    <div class="absolute top-1/4 right-0 w-96 h-96 border-2 border-klein-blue rounded-full translate-x-1/2 blur-3xl"></div>
                </div>
                <div class="flex flex-col gap-8 relative z-10 mt-48 w-full">
                    <div class="font-mono text-sm text-klein-blue mb-4 tracking-[0.3em] font-bold">SYSTEM MAP</div>
                    <a v-for="(link, index) in systemLinks" :key="link.name" href="#" class="group flex items-center gap-6 text-[clamp(2.5rem,5vw,4rem)] font-black text-transparent bg-clip-text bg-gradient-to-r from-gray-900 via-gray-500 to-gray-900 dark:from-white dark:via-gray-400 dark:to-white hover:to-klein-blue transition-all duration-500 p-2 pr-4 block w-full leading-none" style="-webkit-text-stroke: 1px rgba(128,128,128,0.2);">
                        <span class="font-mono text-sm text-klein-blue opacity-50 group-hover:opacity-100 transition-opacity translate-y-2">0{{index+1}}</span>
                        <span class="group-hover:translate-x-6 transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]">{{ link.name }}</span>
                        <span class="opacity-0 -ml-8 group-hover:ml-0 group-hover:opacity-100 transition-all duration-500 delay-100"><i data-lucide="arrow-right" class="w-8 h-8 text-klein-blue"></i></span>
                    </a>
                </div>
                <div class="absolute bottom-16 left-8 md:left-16 font-mono text-xs text-gray-500 flex gap-12">
                    <div><p class="font-bold mb-2 tracking-widest text-klein-blue">STATUS</p><p class="flex items-center gap-2"><span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> ONLINE</p></div>
                    <div><p class="font-bold mb-2 tracking-widest text-klein-blue">VERSION</p><p>v2.5.0 (2025)</p></div>
                </div>
            </aside>
        </transition>

        <main class="transition-all duration-500" :class="{ 'scale-95 opacity-50 blur-sm pointer-events-none grayscale': isSidebarOpen }">
            
            <!-- Hero Section (Fixed Layout) -->
            <section id="home" class="relative w-full h-screen flex flex-col justify-start overflow-hidden bg-white dark:bg-[#000814]">
                <div class="absolute top-[-20%] left-[-10%] w-[60vw] h-[60vw] bg-klein-blue/20 rounded-full blur-[120px] pointer-events-none animate-pulse-slow"></div>
                <div class="absolute bottom-[10%] right-[-10%] w-[40vw] h-[40vw] bg-purple-900/20 rounded-full blur-[100px] pointer-events-none"></div>

                <div class="absolute inset-0 flex flex-col justify-between opacity-60 dark:opacity-30 pointer-events-none select-none overflow-hidden py-12 z-0">
                    <div class="marquee-container -rotate-6 scale-110 origin-left translate-y-32">
                        <div class="marquee-content animate-marquee text-[12vw] font-black text-gray-200 dark:text-[#111] whitespace-nowrap leading-none">
                            ARCHITECT // DESIGN // CODE // ARCHITECT // DESIGN // CODE //
                        </div>
                         <div class="marquee-content animate-marquee text-[12vw] font-black text-gray-200 dark:text-[#111] whitespace-nowrap leading-none">
                            ARCHITECT // DESIGN // CODE // ARCHITECT // DESIGN // CODE //
                        </div>
                    </div>
                </div>

                <!-- Split Layout: Text vs Magnetic Logo -->
                <div class="relative w-full h-full flex flex-col md:flex-row z-10 pt-24 md:pt-0">
                    
                    <!-- Left: Text Area -->
                    <div class="w-full md:w-[45%] h-full flex flex-col justify-center px-6 md:pl-20 z-20">
                        <div class="flex items-center gap-4 mb-8">
                            <div class="w-20 h-[4px] bg-klein-blue shadow-[0_0_15px_rgba(0,47,167,0.8)]"></div>
                            <p class="font-mono text-klein-blue tracking-[0.4em] text-sm font-bold animate-pulse">PORTFOLIO 2025</p>
                        </div>

                        <div class="relative">
                            <h1 class="text-[15vw] md:text-[10vw] leading-[0.85] font-black tracking-tighter text-black dark:text-white mix-blend-normal">MICHAEL</h1>
                            <h1 class="text-[15vw] md:text-[10vw] leading-[0.85] font-black tracking-tighter outline-text pl-4">QIU</h1>
                            <div class="absolute top-0 right-4 md:-right-10 bg-klein-blue text-white font-mono text-xs px-3 py-1 -rotate-6 rounded">DEV.01</div>
                        </div>

                        <div class="mt-12 pl-6 border-l-4 border-gray-300 dark:border-white/10 max-w-md">
                            <p class="text-xl font-light text-gray-700 dark:text-gray-300 leading-relaxed">
                                Designing digital utilities that feel <span class="text-klein-blue font-bold italic bg-white/10 px-1 rounded">inevitable</span>.
                            </p>
                        </div>
                        
                        <div class="mt-12 flex items-center gap-4 text-gray-500 font-mono text-xs">
                            <i data-lucide="arrow-down" class="w-5 h-5 animate-bounce"></i>
                            <span class="tracking-widest">INITIATE SCROLL</span>
                        </div>
                    </div>

                    <!-- Right: Magnetic Logo (Contained) -->
                    <div class="w-full md:w-[55%] h-[50vh] md:h-full flex items-center justify-center relative md:pr-10">
                         <div id="magnetic-container" class="w-full h-full md:h-[80%] relative cursor-crosshair"></div>
                    </div>
                </div>
            </section>

            <!-- Spacer -->
            <section class="w-full py-32 bg-klein-blue text-white overflow-hidden relative border-y border-white/10">
                <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                <div class="marquee-container -rotate-1">
                    <div class="marquee-content animate-marquee text-[8vw] font-display font-black whitespace-nowrap">
                        BE WILD • BE CREATIVE • BE COOL • BE WILD • BE CREATIVE • BE COOL •
                    </div>
                    <div class="marquee-content animate-marquee text-[8vw] font-display font-black whitespace-nowrap">
                        BE WILD • BE CREATIVE • BE COOL • BE WILD • BE CREATIVE • BE COOL •
                    </div>
                </div>
            </section>

            <!-- Profile Section (Contrasted Text) -->
            <section id="profile" class="w-full py-32 px-6 md:px-12 relative bg-white dark:bg-[#050505]">
                <div class="max-w-[90vw] mx-auto relative z-10">
                    <div class="flex items-end justify-between mb-24 border-b border-gray-200 dark:border-white/10 pb-8">
                        <div>
                             <div class="flex items-center gap-3 mb-2">
                                <span class="w-3 h-3 bg-klein-blue rounded-full"></span>
                                <span class="font-display font-bold tracking-widest text-xl text-black dark:text-white">PROFILE</span>
                             </div>
                             <h2 class="text-3xl font-light text-gray-500">The Architect</h2>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6 auto-rows-[minmax(220px,auto)]">
                        <!-- Main Info -->
                        <div class="col-span-1 md:col-span-2 lg:col-span-2 row-span-2 glass-card p-10 flex flex-col justify-between relative overflow-hidden group">
                             <div class="absolute top-0 right-0 w-80 h-80 bg-gradient-to-br from-klein-blue/30 to-transparent rounded-full blur-[80px] -translate-y-1/2 translate-x-1/2 group-hover:bg-klein-blue/40 transition-colors duration-500"></div>
                             <div>
                                 <h3 class="font-mono text-xs text-klein-blue mb-6 tracking-widest border border-klein-blue/30 inline-block px-3 py-1 rounded-full">ABOUT_ME</h3>
                                 <p class="text-2xl md:text-3xl font-light leading-snug text-gray-900 dark:text-gray-100">
                                     I don't just write code; <span class="font-bold border-b-2 border-klein-blue">I design workflows.</span> My background in C++ and Python allows me to build rigorous back-end systems, while my passion for Swift ensures fluid intuition.
                                 </p>
                             </div>
                             <div class="mt-12 flex justify-between items-end border-t border-gray-200 dark:border-white/10 pt-6">
                                 <div>
                                     <span class="block font-mono text-xs text-gray-500 mb-1">LOCATION</span>
                                     <span class="font-bold text-xl text-black dark:text-white">127.0.0.1</span>
                                 </div>
                                 <i data-lucide="map-pin" class="w-6 h-6 text-klein-blue"></i>
                             </div>
                        </div>
                        <!-- Stack -->
                        <div class="col-span-1 md:col-span-1 glass-card p-8 flex flex-col justify-between hover:bg-klein-blue dark:hover:bg-klein-blue hover:text-white dark:hover:text-white transition-all duration-300 group">
                            <div class="flex justify-between items-start">
                                <h3 class="font-mono text-xs opacity-60 text-black dark:text-white group-hover:text-white">STACK</h3>
                                <i data-lucide="layers" class="w-6 h-6 opacity-60 text-black dark:text-white group-hover:text-white"></i>
                            </div>
                            <ul class="space-y-3 mt-4 font-bold text-2xl text-black dark:text-white group-hover:text-white">
                                <li>Python</li>
                                <li>C++</li>
                                <li>SwiftUI</li>
                                <li>Vue.js</li>
                            </ul>
                        </div>
                         <!-- Focus -->
                        <div class="col-span-1 md:col-span-1 glass-card p-8 flex flex-col justify-between hover:bg-black dark:hover:bg-white hover:text-white dark:hover:text-black transition-all duration-300 group">
                            <div class="flex justify-between items-start">
                                <h3 class="font-mono text-xs opacity-60 text-black dark:text-white group-hover:text-current">FOCUS</h3>
                                <i data-lucide="crosshair" class="w-6 h-6 opacity-60 text-black dark:text-white group-hover:text-current"></i>
                            </div>
                             <div class="mt-4">
                                <p class="text-4xl font-black leading-none text-black dark:text-white group-hover:text-current">System<br>Utils</p>
                            </div>
                        </div>
                         <!-- Motto -->
                        <div class="col-span-1 md:col-span-2 lg:col-span-2 row-span-1 glass-card p-10 flex flex-col justify-center relative overflow-hidden group border-l-4 border-l-klein-blue">
                             <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-klein-blue/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                             <h3 class="font-mono text-xs text-gray-500 mb-4 relative z-10">PHILOSOPHY</h3>
                             <p class="text-2xl md:text-3xl font-serif italic text-gray-800 dark:text-gray-200 relative z-10 leading-tight">
                                 "Give people wonderful tools, and they'll do wonderful things."
                             </p>
                             <p class="text-right text-sm font-bold mt-4 text-klein-blue relative z-10">— Steve Jobs</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Works Section: Apple-Style Transition (Revised) -->
            <section id="works" class="relative bg-[#050505]">
                
                <!-- Sticky Container for 3D Elements -->
                <div class="sticky top-0 w-full h-screen flex items-center justify-center overflow-hidden z-0">
                    <!-- Background Elements -->
                    <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,#001030_0%,#000000_70%)] opacity-80"></div>
                    <div class="absolute inset-0 mask-fade-edges z-10 pointer-events-none"></div>
                    
                    <!-- 3D Canvas -->
                    <div class="w-full h-full" ref="canvasContainer"></div>
                    
                    <!-- Texture Error Fallback -->
                    <div v-if="textureError" class="absolute top-4 right-4 z-50 bg-red-900/80 text-white p-4 rounded">Texture Failed</div>
                </div>

                <!-- Scrolling Content Sections (Overlaying the sticky canvas) -->
                <div class="relative z-10">
                    
                    <!-- Intro Spacer -->
                    <div class="h-[50vh] flex flex-col justify-center items-center pointer-events-none">
                        <h2 class="text-6xl md:text-8xl font-black text-white tracking-tighter mb-4 mix-blend-difference">WORKS</h2>
                        <p class="font-mono text-klein-blue tracking-widest">UTILITIES FOR POWER USERS</p>
                    </div>

                    <!-- App 1 Section -->
                    <div class="app-section min-h-screen flex items-center justify-end px-6 md:px-24" data-index="0">
                        <div class="max-w-md bg-black/40 backdrop-blur-xl border border-white/10 p-8 rounded-2xl transform translate-x-0 md:translate-x-0 transition-all duration-500 hover:border-klein-blue/50">
                            <span class="text-klein-blue font-mono text-xs tracking-widest mb-2 block">01 / SYSTEM</span>
                            <h3 class="text-4xl font-bold text-white mb-4">DesktopRenamer</h3>
                            <p class="text-gray-400 text-lg leading-relaxed mb-6">
                                Customizes the name of your current desktop in the menubar. Clean, simple, essential for organized workflows.
                            </p>
                            <div class="flex items-center gap-4">
                                <span class="px-3 py-1 bg-white/10 rounded text-xs font-mono text-gray-300">SWIFT</span>
                                <span class="px-3 py-1 bg-white/10 rounded text-xs font-mono text-gray-300">MACOS</span>
                            </div>
                        </div>
                    </div>

                    <!-- App 2 Section -->
                    <div class="app-section min-h-screen flex items-center justify-start px-6 md:px-24" data-index="1">
                        <div class="max-w-md bg-black/40 backdrop-blur-xl border border-white/10 p-8 rounded-2xl hover:border-klein-blue/50">
                            <span class="text-klein-blue font-mono text-xs tracking-widest mb-2 block">02 / GAMING</span>
                            <h3 class="text-4xl font-bold text-white mb-4">OptClicker</h3>
                            <p class="text-gray-400 text-lg leading-relaxed mb-6">
                                Simulate right-click via Option key. Optimised for high-speed touchpad gaming interactions where milliseconds count.
                            </p>
                            <div class="flex items-center gap-4">
                                <span class="px-3 py-1 bg-white/10 rounded text-xs font-mono text-gray-300">C++</span>
                                <span class="px-3 py-1 bg-white/10 rounded text-xs font-mono text-gray-300">INPUT</span>
                            </div>
                        </div>
                    </div>

                    <!-- App 3 Section -->
                    <div class="app-section min-h-screen flex items-center justify-end px-6 md:px-24" data-index="2">
                        <div class="max-w-md bg-black/40 backdrop-blur-xl border border-white/10 p-8 rounded-2xl hover:border-klein-blue/50">
                            <span class="text-klein-blue font-mono text-xs tracking-widest mb-2 block">03 / FOCUS</span>
                            <h3 class="text-4xl font-bold text-white mb-4">SpaceSwitcher</h3>
                            <p class="text-gray-400 text-lg leading-relaxed mb-6">
                                Control app visibility across specific workspaces. The ultimate focus tool for separating work and play environments.
                            </p>
                            <div class="flex items-center gap-4">
                                <span class="px-3 py-1 bg-white/10 rounded text-xs font-mono text-gray-300">OBJ-C</span>
                                <span class="px-3 py-1 bg-white/10 rounded text-xs font-mono text-gray-300">WM</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Spacer at bottom to allow full scroll -->
                    <div class="h-[50vh]"></div>
                </div>
            </section>
            
            <!-- Connect Section -->
            <section id="connect" class="w-full py-32 px-6 md:px-12 bg-[#000814] text-white border-t border-white/10 relative z-20">
                <div class="max-w-7xl mx-auto">
                    <div class="flex items-center gap-3 mb-16">
                        <span class="w-3 h-3 bg-klein-blue rounded-full"></span>
                        <span class="font-display font-bold tracking-widest text-xl">CONNECT</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <a href="https://github.com/gitmichaelqiu/" target="_blank" class="group relative block h-80 overflow-hidden rounded-3xl bg-[#0a0a0a] border border-white/10 hover:border-klein-blue transition-all duration-500">
                            <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-gray-200/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                            <div class="relative z-10 h-full p-10 flex flex-col justify-between">
                                <div class="flex justify-between items-start">
                                    <i data-lucide="github" class="w-12 h-12 text-gray-500 group-hover:text-white transition-colors"></i>
                                    <span class="w-12 h-12 rounded-full border border-white/20 flex items-center justify-center group-hover:bg-klein-blue group-hover:border-klein-blue transition-all"><i data-lucide="arrow-up-right" class="w-6 h-6"></i></span>
                                </div>
                                <div><h3 class="text-4xl font-bold mb-3">GitHub</h3><p class="text-gray-500 group-hover:text-klein-blue transition-colors text-xl">Explore source code</p></div>
                            </div>
                        </a>
                        <a href="https://www.kaggle.com/michaelqiu0606" target="_blank" class="group relative block h-80 overflow-hidden rounded-3xl bg-[#0a0a0a] border border-white/10 hover:border-[#20BEFF] transition-all duration-500">
                            <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-[#20BEFF]/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                            <div class="relative z-10 h-full p-10 flex flex-col justify-between">
                                <div class="flex justify-between items-start">
                                    <div class="text-4xl font-black text-gray-500 group-hover:text-[#20BEFF] transition-colors">K</div>
                                    <span class="w-12 h-12 rounded-full border border-white/20 flex items-center justify-center group-hover:bg-[#20BEFF] group-hover:border-[#20BEFF] group-hover:text-white transition-all"><i data-lucide="arrow-up-right" class="w-6 h-6"></i></span>
                                </div>
                                <div><h3 class="text-4xl font-bold mb-3">Kaggle</h3><p class="text-gray-500 group-hover:text-[#20BEFF] transition-colors text-xl">View data science projects</p></div>
                            </div>
                        </a>
                    </div>
                </div>
            </section>

            <footer class="w-full py-16 px-6 md:px-12 border-t border-white/10 bg-black text-gray-500 flex flex-col md:flex-row justify-between items-center text-sm font-mono transition-colors duration-500 relative z-20">
                <p>&copy; 2025 MICHAEL QIU. ALL RIGHTS RESERVED.</p>
                <div class="flex gap-8 mt-6 md:mt-0">
                    <a href="#home" class="hover:text-klein-blue transition-colors">BACK TO TOP</a>
                    <a href="mailto:contact@michaelqiu.com" class="hover:text-klein-blue transition-colors">CONTACT</a>
                </div>
                <p class="mt-6 md:mt-0">DESIGNED IN THE VOID</p>
            </footer>
        </main>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted, watch, nextTick } = Vue;

        createApp({
            setup() {
                const isSidebarOpen = ref(false);
                const themeMode = ref('auto'); 
                const activeTheme = ref('dark'); 
                
                const scrollProgress = ref(0);
                const activeSection = ref('home');
                const isCapsuleOpen = ref(false);
                
                const loader = ref(null);
                const canvasContainer = ref(null);
                const textureError = ref(false);

                const systemLinks = [
                    { name: 'HOME' },
                    { name: 'WRITINGS' },
                    { name: 'ARCHIVE' },
                    { name: 'LABS' }
                ];
                
                const apps = [
                    { id: 'DesktopRenamer', name: 'DesktopRenamer', desc: 'Customizes the name of your current desktop in the menubar.', img: 'resources/DesktopRenamer.png' },
                    { id: 'OptClick', name: 'OptClicker', desc: 'Simulate right-click via Option key.', img: 'resources/OptClicker.png' },
                    { id: 'SpaceSwitcher', name: 'SpaceSwitcher', desc: 'Control app visibility across specific workspaces.', img: 'resources/SpaceSwitcher.png' }
                ];

                let scene, camera, renderer, appsGroup;
                let mouseX = 0, mouseY = 0;
                let icons = []; // Array to store 3D meshes
                let lenis;

                const capsulePerimeter = 360; 
                const capsuleDashOffset = computed(() => {
                    const progress = Math.min(100, Math.max(0, scrollProgress.value));
                    return Math.max(0, capsulePerimeter - (progress / 100) * capsulePerimeter);
                });

                const toggleCapsuleNav = () => { isCapsuleOpen.value = !isCapsuleOpen.value; };
                const toggleSidebar = () => { isSidebarOpen.value = !isSidebarOpen.value; };

                watch(isSidebarOpen, (newVal) => { if (newVal) nextTick(() => lucide.createIcons()); });

                const resolveTheme = () => {
                    let resolved = 'dark';
                    if (themeMode.value === 'auto') {
                        resolved = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                    } else {
                        resolved = themeMode.value;
                    }
                    activeTheme.value = resolved;
                    if (resolved === 'dark') document.documentElement.classList.add('dark');
                    else document.documentElement.classList.remove('dark');
                    // updateSceneTheme(); // Not needed for new Works style as bg is black
                };

                const cycleTheme = () => {
                    if (themeMode.value === 'auto') themeMode.value = 'light';
                    else if (themeMode.value === 'light') themeMode.value = 'dark';
                    else themeMode.value = 'auto';
                    resolveTheme();
                };

                const updateScrollProgress = () => {
                    // Lenis takes over scrolling, but we use window values for progress
                    const scrollTop = window.scrollY || document.documentElement.scrollTop;
                    const docHeight = document.documentElement.scrollHeight;
                    const winHeight = window.innerHeight;
                    const scrollTotal = docHeight - winHeight;
                    let progress = (scrollTop / (scrollTotal - 1)) * 100;
                    progress = Math.min(100, Math.max(0, progress));
                    scrollProgress.value = progress;
                    
                    if (isCapsuleOpen.value && Math.abs(scrollTop - (window.lastScrollY || 0)) > 10) {
                        isCapsuleOpen.value = false;
                    }
                    window.lastScrollY = scrollTop;

                    const sections = ['home', 'profile', 'works', 'connect'];
                    for (const section of sections) {
                        const el = document.getElementById(section);
                        if (el) {
                            const rect = el.getBoundingClientRect();
                            if (rect.top <= winHeight / 2 && rect.bottom >= winHeight / 2) {
                                activeSection.value = section;
                            }
                        }
                    }
                };

                const initCursor = () => {
                    const dot = document.querySelector('.cursor-dot');
                    const outline = document.querySelector('.cursor-outline');
                    if(dot && outline) {
                        window.addEventListener('mousemove', (e) => {
                            const posX = e.clientX;
                            const posY = e.clientY;
                            dot.style.left = `${posX}px`; 
                            dot.style.top = `${posY}px`;
                            outline.animate({ left: `${posX}px`, top: `${posY}px` }, { duration: 500, fill: "forwards" });
                        });
                    }
                };

                const initMagneticLogo = () => {
                    const container = document.getElementById('magnetic-container');
                    if (!container) return;
                    
                    // Clear previous content
                    container.innerHTML = '';

                    const logoPaths = [
                        "M443.24,16.93l-149.03,273.93c-3.34,6.14-5.12,13.33-5.12,20.68v145.02c0,20.73,13.85,37.54,30.94,37.54h149.03c17.09,0,30.94-16.81,30.94-37.54V37.61c0-37.23-39.85-51.75-56.75-20.68Z",
                        "M232.72,17.08L5.16,435.89c-13.56,24.96,1.19,58.2,25.83,58.2H167.51c10.4,0,20.1-6.34,25.83-16.88l91.04-167.55c3.33-6.13,5.11-13.32,5.11-20.66V37.74c0-37.24-39.87-51.75-56.76-20.66Z",
                        "M841.59,437.09l-178.07-239.47c-7.36-9.89-19.53-15.81-32.53-15.81h-60.8c-21.79,0-39.45,16.3-39.45,36.4v239.47c0,20.11,17.66,36.4,39.45,36.4h238.88c31.75,0,50.49-32.84,32.53-57Z",
                        "M693.68,164.05l86.8-117.52c13.58-18.38,.45-44.39-22.4-44.39h-173.6c-22.85,0-35.98,26.01-22.4,44.39l86.8,117.52c11.13,15.07,33.67,15.07,44.8,0Z"
                    ];

                    const width = container.clientWidth;
                    const height = container.clientHeight;
                    
                    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    svg.setAttribute("width", "100%");
                    svg.setAttribute("height", "100%");
                    svg.style.overflow = "visible";
                    container.appendChild(svg);

                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');

                    // Responsive scaling to fit container with padding
                    // Base scale on smaller dimension, ensure logo is fully visible
                    const logoScale = Math.min(width, height) / 600; 
                    const offsetX = (width - 848.58 * logoScale) / 2;
                    const offsetY = (height - 494.09 * logoScale) / 2;

                    ctx.fillStyle = "black";
                    ctx.save();
                    ctx.translate(offsetX, offsetY);
                    ctx.scale(logoScale, logoScale);
                    
                    logoPaths.forEach(pathD => {
                        const p = new Path2D(pathD);
                        ctx.fill(p);
                    });
                    ctx.restore();

                    const step = 22; // Density of balls
                    const balls = [];
                    const mouseRadius = 250; 

                    for (let y = 0; y < height; y += step) {
                        for (let x = 0; x < width; x += step) {
                            const pixel = ctx.getImageData(x, y, 1, 1).data;
                            if (pixel[3] > 128) {
                                const ball = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                                ball.setAttribute("class", "text-klein-blue fill-current magnetic-ball");
                                ball.setAttribute("cx", x);
                                ball.setAttribute("cy", y);
                                ball.setAttribute("r", 5); 
                                
                                const point = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                                point.setAttribute("class", "text-gray-500 fill-current opacity-20");
                                point.setAttribute("cx", x);
                                point.setAttribute("cy", y);
                                point.setAttribute("r", 1.5);

                                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                                line.setAttribute("class", "text-klein-blue stroke-current");
                                line.setAttribute("x1", x);
                                line.setAttribute("y1", y);
                                line.setAttribute("x2", x);
                                line.setAttribute("y2", y);
                                
                                svg.appendChild(line);
                                svg.appendChild(point);
                                svg.appendChild(ball);

                                balls.push({ el: ball, line: line, ori_x: x, ori_y: y });
                            }
                        }
                    }

                    const onMouseMove = (e) => {
                        const rect = container.getBoundingClientRect();
                        const mouseX = e.clientX - rect.left;
                        const mouseY = e.clientY - rect.top;

                        balls.forEach(ball => {
                            const dx = ball.ori_x - mouseX;
                            const dy = ball.ori_y - mouseY;
                            const dist = Math.sqrt(dx * dx + dy * dy);

                            if (dist < mouseRadius) {
                                const angle = Math.atan2(dy, dx);
                                const force = (mouseRadius - dist) / mouseRadius; 
                                const moveDist = force * 120; 

                                const tx = ball.ori_x + Math.cos(angle) * moveDist;
                                const ty = ball.ori_y + Math.sin(angle) * moveDist;

                                if (ball.animater) ball.animater.kill();
                                ball.animater = gsap.timeline()
                                    .to(ball.el, { attr: { cx: tx, cy: ty }, duration: 0.2, ease: "power3.out" })
                                    .to(ball.line, { attr: { x2: tx, y2: ty }, duration: 0.2, ease: "power3.out" }, "<")
                                    .to(ball.el, { attr: { cx: ball.ori_x, cy: ball.ori_y }, duration: 1.2, ease: "elastic.out(1, 0.3)" }, ">0.05")
                                    .to(ball.line, { attr: { x2: ball.ori_x, y2: ball.ori_y }, duration: 1.2, ease: "elastic.out(1, 0.3)" }, "<");
                            }
                        });
                    };
                    container.addEventListener('mousemove', onMouseMove);
                };

                const createSquircleShape = (size) => {
                    const shape = new THREE.Shape();
                    const width = size; const height = size;
                    const x = -width / 2; const y = -height / 2;
                    const r = 0.7; 
                    shape.moveTo( x, y + r );
                    shape.lineTo( x, y + height - r );
                    shape.quadraticCurveTo( x, y + height, x + r, y + height );
                    shape.lineTo( x + width - r, y + height );
                    shape.quadraticCurveTo( x + width, y + height, x + width, y + height - r );
                    shape.lineTo( x + width, y + r );
                    shape.quadraticCurveTo( x + width, y, x + width - r, y );
                    shape.lineTo( x + r, y );
                    shape.quadraticCurveTo( x, y, x, y + r );
                    return shape;
                };

                const createFallbackTexture = (text) => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 512; canvas.height = 512;
                    const ctx = canvas.getContext('2d');
                    
                    ctx.fillStyle = '#0a0a0a';
                    ctx.fillRect(0, 0, 512, 512);
                    
                    ctx.strokeStyle = '#222';
                    ctx.lineWidth = 2;
                    for(let i=0; i<512; i+=64) {
                        ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, 512); ctx.stroke();
                        ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(512, i); ctx.stroke();
                    }
                    ctx.strokeStyle = '#002FA7';
                    ctx.lineWidth = 15;
                    ctx.beginPath();
                    if (ctx.roundRect) ctx.roundRect(20, 20, 472, 472, 80);
                    else ctx.rect(20, 20, 472, 472);
                    ctx.stroke();

                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 80px "Inter", sans-serif';
                    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                    ctx.fillText(text.substring(0, 2).toUpperCase(), 256, 256);

                    return new THREE.CanvasTexture(canvas);
                };

                const initThreeJS = () => {
                    if (!canvasContainer.value) return;
                    const width = canvasContainer.value.clientWidth;
                    const height = canvasContainer.value.clientHeight;

                    scene = new THREE.Scene();
                    // scene.background = new THREE.Color(0x050505); // Match bg-dark
                    
                    camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 100);
                    camera.position.z = 12;

                    renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                    renderer.setSize(width, height);
                    renderer.setPixelRatio(window.devicePixelRatio);
                    renderer.toneMapping = THREE.ACESFilmicToneMapping;
                    renderer.toneMappingExposure = 1.2;
                    canvasContainer.value.appendChild(renderer.domElement);

                    appsGroup = new THREE.Group();
                    scene.add(appsGroup);

                    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5); 
                    scene.add(ambientLight);
                    
                    const keyLight = new THREE.SpotLight(0xffffff, 2);
                    keyLight.position.set(-10, 10, 10);
                    scene.add(keyLight);

                    const backLight = new THREE.DirectionalLight(0x002FA7, 2);
                    backLight.position.set(0, 5, -10);
                    scene.add(backLight);
                    
                    const size = 3; // Bigger icons for single view
                    const extrudeSettings = { depth: 0.4, bevelEnabled: true, bevelSegments: 5, steps: 1, bevelSize: 0.05, bevelThickness: 0.05 };
                    const shape = createSquircleShape(size); 
                    const geometry = new THREE.ExtrudeGeometry(shape, extrudeSettings);
                    
                    // Center geometry
                    geometry.computeBoundingBox();
                    const max = geometry.boundingBox.max; const min = geometry.boundingBox.min;
                    const range = new THREE.Vector2(max.x - min.x, max.y - min.y);
                    const uvAttribute = geometry.attributes.uv; const posAttribute = geometry.attributes.position;
                    for (let i = 0; i < posAttribute.count; i++) {
                        const x = posAttribute.getX(i); const y = posAttribute.getY(i);
                        uvAttribute.setXY(i, (x - min.x) / range.x, (y - min.y) / range.y);
                    }
                    geometry.attributes.uv.needsUpdate = true;
                    geometry.center();

                    const texLoader = new THREE.TextureLoader();

                    // Create all 3 icons but position them initially
                    // We will use ScrollTrigger to animate their visibility/position
                    apps.forEach((app, i) => {
                        const sideMaterial = new THREE.MeshPhysicalMaterial({
                            color: 0x001133, roughness: 0.2, metalness: 0.8,
                        });
                        const frontMaterial = new THREE.MeshStandardMaterial({
                            color: 0xffffff, roughness: 0.4, metalness: 0.1
                        });

                        texLoader.load(app.img, 
                            (texture) => {
                                texture.encoding = THREE.sRGBEncoding;
                                texture.center.set(0.5, 0.5);
                                frontMaterial.map = texture;
                                frontMaterial.needsUpdate = true;
                            },
                            undefined,
                            () => {
                                const fallback = createFallbackTexture(app.name);
                                frontMaterial.map = fallback;
                                frontMaterial.needsUpdate = true;
                            }
                        );

                        const mesh = new THREE.Mesh(geometry, [frontMaterial, sideMaterial]);
                        // Position all icons off-screen initially, except maybe first one
                        mesh.position.set(0, -10, 0); 
                        mesh.rotation.x = 0;
                        mesh.rotation.y = 0;
                        
                        appsGroup.add(mesh);
                        icons.push(mesh);
                    });

                    // Mouse Parallax Logic
                    document.addEventListener('mousemove', (event) => {
                        // Apply slight rotation to the ACTIVE icon based on mouse
                        // We check which app section is in view or apply to all group
                        mouseX = (event.clientX - window.innerWidth / 2) * 0.0005;
                        mouseY = (event.clientY - window.innerHeight / 2) * 0.0005;
                    });

                    window.addEventListener('resize', () => {
                        if(!canvasContainer.value) return;
                        const w = canvasContainer.value.clientWidth;
                        const h = canvasContainer.value.clientHeight;
                        camera.aspect = w / h;
                        camera.updateProjectionMatrix();
                        renderer.setSize(w, h);
                    });

                    const animate = () => {
                        requestAnimationFrame(animate);
                        
                        // Subtle floating animation for all icons
                        icons.forEach((icon, i) => {
                            // Only animate if somewhat visible (optimization)
                            icon.rotation.x += 0.05 * (mouseY * 2 - icon.rotation.x);
                            icon.rotation.y += 0.05 * (mouseX * 2 - icon.rotation.y);
                        });
                        
                        renderer.render(scene, camera);
                    };
                    animate();

                    // GSAP ScrollTriggers for Apple-style sequence
                    const sections = document.querySelectorAll('.app-section');
                    sections.forEach((section, index) => {
                        ScrollTrigger.create({
                            trigger: section,
                            start: "top center",
                            end: "bottom center",
                            onEnter: () => animateIconIn(index),
                            onEnterBack: () => animateIconIn(index),
                            onLeave: () => animateIconOut(index, 1), // 1 = down
                            onLeaveBack: () => animateIconOut(index, -1) // -1 = up
                        });
                    });
                };

                const animateIconIn = (index) => {
                    const icon = icons[index];
                    if(!icon) return;
                    gsap.to(icon.position, { y: 0, duration: 1, ease: "power3.out" });
                    gsap.to(icon.scale, { x: 1, y: 1, z: 1, duration: 1, ease: "elastic.out(1, 0.8)" });
                    gsap.to(icon.rotation, { x: 0, y: 0, z: 0, duration: 1 });
                };

                const animateIconOut = (index, direction) => {
                    const icon = icons[index];
                    if(!icon) return;
                    // Exit direction depends on scroll
                    const targetY = direction > 0 ? 10 : -10; 
                    gsap.to(icon.position, { y: targetY, duration: 0.8, ease: "power3.in" });
                    gsap.to(icon.scale, { x: 0.5, y: 0.5, z: 0.5, duration: 0.8 });
                };

                const initLenis = () => {
                    lenis = new Lenis({
                        duration: 2.0, 
                        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
                        direction: 'vertical',
                        gestureDirection: 'vertical',
                        smooth: true,
                        mouseMultiplier: 0.8,
                        smoothTouch: false,
                        touchMultiplier: 2,
                    });
                    function raf(time) {
                        lenis.raf(time);
                        requestAnimationFrame(raf);
                    }
                    requestAnimationFrame(raf);
                };

                onMounted(() => {
                    setTimeout(() => {
                        if(loader.value) {
                            loader.value.style.opacity = '0';
                            setTimeout(() => { loader.value.style.display = 'none'; }, 500);
                        }
                        gsap.from(".reveal-text", { y: 100, opacity: 0, duration: 1.2, stagger: 0.1, ease: "power4.out", delay: 0.5 });
                        initMagneticLogo();
                    }, 1500);

                    lucide.createIcons();
                    resolveTheme(); 
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', resolveTheme);
                    initThreeJS();
                    initCursor();
                    initLenis(); 
                    window.addEventListener('scroll', updateScrollProgress);
                });
                
                onUnmounted(() => {
                    window.removeEventListener('scroll', updateScrollProgress);
                    window.matchMedia('(prefers-color-scheme: dark)').removeEventListener('change', resolveTheme);
                    if(lenis) lenis.destroy();
                });

                return {
                    isSidebarOpen,
                    themeMode,
                    activeTheme,
                    scrollProgress,
                    activeSection,
                    isCapsuleOpen,
                    capsulePerimeter,
                    capsuleDashOffset,
                    toggleSidebar,
                    toggleCapsuleNav,
                    cycleTheme,
                    loader,
                    canvasContainer,
                    // hoverApp, // No longer needed
                    // resetApp, // No longer needed
                    apps,
                    systemLinks,
                    textureError
                };
            }
        }).mount('#app');
    </script>
</body>
</html>