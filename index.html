<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Michael Qiu | Workspace Architect</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    colors: {
                        'klein-blue': '#002FA7',
                        'neon-green': '#17f700',
                        'bg-dark': '#050505',
                        'bg-light': '#F2F2F7', 
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        display: ['Syncopate', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'marquee': 'marquee 30s linear infinite',
                        'marquee-reverse': 'marqueeReverse 35s linear infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        marquee: {
                            '0%': { transform: 'translateX(0%)' },
                            '100%': { transform: 'translateX(-100%)' },
                        },
                        marqueeReverse: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0%)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <!-- Lenis (Smooth Scroll) -->
    <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&family=JetBrains+Mono:wght@400;700&family=Syncopate:wght@700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --klein-blue: #002FA7;
        }

        body {
            background-color: #F2F2F7;
            color: #111;
            transition: background 0.5s ease, color 0.5s ease;
        }

        html.dark body {
            background-color: #050505;
            color: #ffffff;
        }

        /* Lenis */
        html.lenis { height: auto; }
        .lenis.lenis-smooth { scroll-behavior: auto; }
        .lenis.lenis-smooth [data-lenis-prevent] { overscroll-behavior: contain; }
        .lenis.lenis-stopped { overflow: hidden; }
        .lenis.lenis-scrolling iframe { pointer-events: none; }

        /* Custom Cursor */
        @media (hover: hover) and (pointer: fine) {
            body { cursor: none !important; }
            .cursor-dot, .cursor-outline { display: block; }
        }
        .cursor-dot, .cursor-outline {
            position: fixed; top: 0; left: 0;
            transform: translate(-50%, -50%); border-radius: 50%;
            z-index: 20000; pointer-events: none; mix-blend-mode: difference;
        }
        .cursor-dot { width: 8px; height: 8px; background-color: white; }
        .cursor-outline { width: 40px; height: 40px; border: 1px solid white; transition: width 0.2s, height 0.2s; }
        body:hover .cursor-outline { width: 30px; height: 30px; }

        /* Typography */
        .outline-text { color: transparent; -webkit-text-stroke: 1px rgba(255, 255, 255, 0.5); }
        .text-stroke-black { -webkit-text-stroke: 1px rgba(0,0,0,0.8); }
        
        /* Glass Cards */
        .glass-card { background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(0, 0, 0, 0.1); transition: all 0.3s ease; }
        html.dark .glass-card { background: rgba(20, 20, 20, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-card:hover { border-color: var(--klein-blue); background: rgba(0, 47, 167, 0.05); }

        /* Marquee */
        .marquee-container { overflow: hidden; white-space: nowrap; display: flex; }
        .marquee-content { display: flex; flex-shrink: 0; }
        .animate-marquee { animation: marquee 30s linear infinite; }
        .animate-marquee-reverse { animation: marqueeReverse 35s linear infinite; }

        /* Transitions */
        .sidebar-enter-active, .sidebar-leave-active { transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1); }
        .sidebar-enter-from, .sidebar-leave-to { transform: translateX(-100%); }
        .backdrop-enter-active, .backdrop-leave-active { transition: opacity 0.4s ease; }
        .backdrop-enter-from, .backdrop-leave-to { opacity: 0; }

        /* Loader */
        .loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #002FA7; z-index: 20000; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        
        .capsule-nav { transition: width 0.3s ease, background-color 0.3s ease, color 0.3s ease; }

        /* Mask Gradient */
        .mask-fade-edges {
            mask-image: linear-gradient(to right, transparent 0%, black 15%, black 85%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 15%, black 85%, transparent 100%);
        }

        .magnetic-ball { transition: fill-opacity 0.5s ease; }
        .magnetic-ball line { stroke: currentColor; stroke-width: 1.5; opacity: 0.2; }
        
        /* Nav Uniform Styles */
        .nav-button {
            transition: all 0.3s ease;
            backdrop-filter: blur(12px);
        }
    </style>
</head>
<body>
    <div id="app" class="relative min-h-screen selection:bg-white selection:text-klein-blue">
        
        <div class="cursor-dot hidden md:block"></div>
        <div class="cursor-outline hidden md:block"></div>

        <div class="loader" ref="loader">
            <div class="flex items-end gap-1 mb-4">
                <div class="w-2 h-8 bg-white animate-bounce" style="animation-delay: 0s"></div>
                <div class="w-2 h-12 bg-white/50 animate-bounce" style="animation-delay: 0.1s"></div>
                <div class="w-2 h-6 bg-white animate-bounce" style="animation-delay: 0.2s"></div>
            </div>
            <div class="font-mono text-sm tracking-[0.3em] text-white">SYSTEM_BOOT</div>
        </div>

        <!-- Navigation Bar -->
        <nav class="fixed top-0 left-0 w-full z-[9990] px-6 py-6 md:px-10 md:py-8 flex justify-between items-center pointer-events-none">
            
            <!-- Left: Sidebar Trigger -->
            <button @click="toggleSidebar" 
                    class="nav-button group w-12 h-12 rounded-full flex flex-col justify-center items-center gap-1.5 pointer-events-auto border shadow-lg"
                    :class="navColorClass">
                <span class="w-5 h-0.5 bg-current transition-all duration-300 group-hover:w-7"></span>
                <span class="w-7 h-0.5 bg-current transition-all duration-300 group-hover:w-5"></span>
            </button>
            
            <!-- Center: Progress Capsule -->
            <div class="absolute left-1/2 -translate-x-1/2 pointer-events-auto">
                <div class="relative group cursor-pointer" @click="toggleCapsuleNav">
                    <!-- Dynamic coloring based on navColorClass -->
                    <div class="nav-button border rounded-full h-12 flex items-center justify-center overflow-hidden shadow-2xl"
                         :class="[isCapsuleOpen ? 'w-[340px]' : 'w-[140px]', navColorClass]">
                        
                        <div v-if="!isCapsuleOpen" class="font-mono text-xs font-bold tracking-[0.2em] px-6 animate-fade-in">
                            {{ activeSection.toUpperCase() }}
                        </div>

                        <div v-else class="flex gap-5 font-mono text-[10px] font-bold px-6 animate-fade-in whitespace-nowrap">
                            <a href="#home" class="hover:opacity-60 transition-opacity">HOME</a>
                            <span>/</span>
                            <a href="#profile" class="hover:opacity-60 transition-opacity">PROFILE</a>
                            <span>/</span>
                            <a href="#works" class="hover:opacity-60 transition-opacity">WORKS</a>
                            <span>/</span>
                            <a href="#connect" class="hover:opacity-60 transition-opacity">CONNECT</a>
                        </div>
                    </div>

                    <!-- Progress Ring -->
                    <svg class="absolute top-0 left-0 w-full h-full pointer-events-none" style="overflow: visible;">
                        <rect x="0" y="0" width="100%" height="100%" rx="24" ry="24" 
                              fill="none" stroke="transparent" stroke-width="2" />
                         <rect x="0" y="0" width="100%" height="100%" rx="24" ry="24" 
                              fill="none" stroke="currentColor" stroke-width="2"
                              :stroke-dasharray="capsulePerimeter"
                              :stroke-dashoffset="capsuleDashOffset"
                              class="text-klein-blue" 
                              style="transition: stroke-dashoffset 0.1s linear, stroke-dasharray 0.5s ease; opacity: 1;" />
                    </svg>
                </div>
            </div>

            <!-- Right: Theme Toggle -->
            <div class="pointer-events-auto">
                <button @click="cycleTheme" 
                        class="nav-button w-12 h-12 rounded-full flex items-center justify-center border shadow-lg hover:rotate-180"
                        :class="navColorClass">
                    <span v-show="themeMode === 'light'" class="animate-fade-in"><i data-lucide="sun" class="w-5 h-5"></i></span>
                    <span v-show="themeMode === 'dark'" class="animate-fade-in"><i data-lucide="moon" class="w-5 h-5"></i></span>
                    <span v-show="themeMode === 'auto'" class="animate-fade-in"><i data-lucide="monitor" class="w-5 h-5"></i></span>
                </button>
            </div>
        </nav>

        <!-- Sidebar (Higher Z-Index) -->
        <transition name="backdrop">
            <div v-if="isSidebarOpen" @click="toggleSidebar" class="fixed inset-0 bg-black/60 backdrop-blur-md z-[9998]"></div>
        </transition>

        <transition name="sidebar">
            <aside v-if="isSidebarOpen" class="fixed top-0 left-0 w-full md:w-[40vw] h-full bg-[#F2F2F7] dark:bg-[#080808] text-black dark:text-white z-[9999] border-r border-gray-200 dark:border-white/10 flex flex-col pl-8 pr-8 md:pl-16 md:pr-16 shadow-[0_0_50px_rgba(0,0,0,0.5)] overflow-y-auto overflow-x-hidden">
                <button @click="toggleSidebar" class="absolute top-8 left-8 md:left-12 w-12 h-12 flex items-center justify-center border-2 border-gray-200 dark:border-white/10 rounded-full hover:border-klein-blue hover:text-white hover:bg-klein-blue transition-all duration-300">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
                <div class="flex flex-col gap-8 relative z-10 mt-48 w-full">
                    <div class="font-mono text-sm text-klein-blue mb-4 tracking-[0.3em] font-bold">SYSTEM MAP</div>
                    <a v-for="(link, index) in systemLinks" :key="link.name" href="#" class="group flex items-center gap-6 text-[clamp(2.5rem,5vw,4rem)] font-black text-transparent bg-clip-text bg-gradient-to-r from-gray-900 via-gray-500 to-gray-900 dark:from-white dark:via-gray-400 dark:to-white hover:to-klein-blue transition-all duration-500 p-2 pr-4 block w-full leading-none" style="-webkit-text-stroke: 1px rgba(128,128,128,0.2);">
                        <span class="font-mono text-sm text-klein-blue opacity-50 group-hover:opacity-100 transition-opacity translate-y-2">0{{index+1}}</span>
                        <span class="group-hover:translate-x-6 transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)]">{{ link.name }}</span>
                        <span class="opacity-0 -ml-8 group-hover:ml-0 group-hover:opacity-100 transition-all duration-500 delay-100"><i data-lucide="arrow-right" class="w-8 h-8 text-klein-blue"></i></span>
                    </a>
                </div>
            </aside>
        </transition>

        <main class="transition-all duration-500" :class="{ 'scale-95 opacity-50 blur-sm pointer-events-none grayscale': isSidebarOpen }">
            
            <!-- Hero Section (Blue Void - FULLSCREEN BALLS) -->
            <section id="home" class="relative w-full min-h-[150vh] flex flex-col justify-start bg-klein-blue text-white overflow-hidden">
                
                <!-- Fixed Fullscreen Magnetic Logo Container -->
                <div class="fixed inset-0 z-0" id="magnetic-wrapper">
                     <!-- Set height to 100vh to fit screen -->
                     <div id="magnetic-container" class="w-full h-screen relative cursor-crosshair transition-opacity duration-300"></div>
                </div>

                <!-- Scrollable Content -->
                <div class="relative z-10 w-full">
                    
                    <!-- Page 1: Logo (Balls) & Name (Bottom) -->
                    <div class="h-screen w-full flex flex-col justify-end px-6 md:px-12 pb-12 md:pb-24 pointer-events-none">
                        <!-- Hero Text Container -->
                        <div class="hero-text-container transform transition-transform duration-100 ease-linear origin-bottom-left">
                            <h1 class="text-[5vw] leading-[0.8] font-black tracking-tighter mix-blend-overlay">MICHAEL</h1>
                            <h1 class="text-[5vw] leading-[0.8] font-black tracking-tighter pl-4 md:pl-8">QIU</h1>
                            
                            <!-- Intro text following name -->
                            <div class="intro-text opacity-0 mt-4 pl-4 max-w-xl transition-opacity duration-1000">
                                <p class="text-2xl font-light leading-relaxed">
                                    Designing digital utilities that feel <span class="font-bold italic text-white/80">inevitable</span>.
                                </p>
                            </div>
                        </div>
                        
                        <div class="absolute bottom-12 right-12 flex flex-col items-end gap-2 font-mono text-xs opacity-70 animate-pulse pointer-events-auto">
                            <span>SCROLL TO BEGIN</span>
                            <i data-lucide="arrow-down" class="w-4 h-4"></i>
                        </div>
                    </div>

                    <!-- Page 2: BE CREATIVE Banner (Scroll Expand) -->
                    <div class="h-[100vh] flex items-center justify-center relative overflow-hidden bg-black z-20" id="banner-trigger">
                        <div class="w-full transform scale-50 opacity-0 transition-all duration-700 ease-out" id="creative-banner">
                            <h2 class="text-[15vw] font-black text-center leading-none tracking-tighter text-white mix-blend-difference">
                                BE<br>CREATIVE
                            </h2>
                        </div>
                    </div>

                </div>
            </section>

            <!-- Profile Section -->
            <section id="profile" class="w-full py-32 px-6 md:px-12 relative bg-[#F2F2F7] dark:bg-[#050505] z-30">
                <div class="max-w-[90vw] mx-auto relative z-10">
                    <div class="flex items-end justify-between mb-24 border-b border-gray-200 dark:border-white/10 pb-8">
                        <h2 class="text-3xl font-light text-gray-500">The Architect</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6 auto-rows-[minmax(220px,auto)]">
                        <!-- Main Info -->
                        <div class="col-span-1 md:col-span-2 lg:col-span-2 row-span-2 glass-card p-10 flex flex-col justify-between relative overflow-hidden group">
                             <div class="absolute top-0 right-0 w-80 h-80 bg-gradient-to-br from-klein-blue/30 to-transparent rounded-full blur-[80px] -translate-y-1/2 translate-x-1/2 group-hover:bg-klein-blue/40 transition-colors duration-500"></div>
                             <div>
                                 <h3 class="font-mono text-xs text-klein-blue mb-6 tracking-widest border border-klein-blue/30 inline-block px-3 py-1 rounded-full">ABOUT_ME</h3>
                                 <p class="text-2xl md:text-3xl font-light leading-snug text-gray-900 dark:text-gray-100">
                                     I don't just write code; <span class="font-bold border-b-2 border-klein-blue">I design workflows.</span> My background in C++ and Python allows me to build rigorous back-end systems.
                                 </p>
                             </div>
                             <div class="mt-12 flex justify-between items-end border-t border-gray-200 dark:border-white/10 pt-6">
                                 <div>
                                     <span class="block font-mono text-xs text-gray-500 mb-1">LOCATION</span>
                                     <span class="font-bold text-xl text-black dark:text-white">127.0.0.1</span>
                                 </div>
                                 <i data-lucide="map-pin" class="w-6 h-6 text-klein-blue"></i>
                             </div>
                        </div>
                        <!-- Stack -->
                        <div class="col-span-1 md:col-span-1 glass-card p-8 flex flex-col justify-between hover:bg-klein-blue hover:text-white transition-all duration-300 group">
                            <div class="flex justify-between items-start">
                                <h3 class="font-mono text-xs opacity-60 text-black dark:text-white group-hover:text-white">STACK</h3>
                                <i data-lucide="layers" class="w-6 h-6 opacity-60 text-black dark:text-white group-hover:text-white"></i>
                            </div>
                            <ul class="space-y-3 mt-4 font-bold text-2xl text-black dark:text-white group-hover:text-white">
                                <li>Python</li>
                                <li>C++</li>
                                <li>SwiftUI</li>
                                <li>Vue.js</li>
                            </ul>
                        </div>
                         <!-- Focus -->
                        <div class="col-span-1 md:col-span-1 glass-card p-8 flex flex-col justify-between hover:bg-black hover:text-white transition-all duration-300 group">
                            <div class="flex justify-between items-start">
                                <h3 class="font-mono text-xs opacity-60 text-black dark:text-white group-hover:text-white">FOCUS</h3>
                                <i data-lucide="crosshair" class="w-6 h-6 opacity-60 text-black dark:text-white group-hover:text-white"></i>
                            </div>
                             <div class="mt-4">
                                <p class="text-4xl font-black leading-none text-black dark:text-white group-hover:text-white">System<br>Utils</p>
                            </div>
                        </div>
                         <!-- Motto -->
                        <div class="col-span-1 md:col-span-2 lg:col-span-2 row-span-1 glass-card p-10 flex flex-col justify-center relative overflow-hidden group border-l-4 border-l-klein-blue">
                             <h3 class="font-mono text-xs text-gray-500 mb-4 relative z-10">PHILOSOPHY</h3>
                             <p class="text-2xl md:text-3xl font-serif italic text-gray-800 dark:text-gray-200 relative z-10 leading-tight">
                                 "Give people wonderful tools, and they'll do wonderful things."
                             </p>
                             <p class="text-right text-sm font-bold mt-4 text-klein-blue relative z-10">â€” Steve Jobs</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Works Section -->
            <section id="works" class="relative bg-[#050505] z-30">
                <div class="sticky top-0 w-full h-screen flex items-center justify-center overflow-hidden z-0">
                    <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,#001030_0%,#000000_70%)] opacity-80"></div>
                    <div class="w-full h-full" ref="canvasContainer"></div>
                </div>

                <div class="relative z-10">
                    <div class="h-[50vh] flex flex-col justify-center items-center pointer-events-none">
                        <h2 class="text-6xl md:text-8xl font-black text-white tracking-tighter mb-4 mix-blend-difference">WORKS</h2>
                        <p class="font-mono text-klein-blue tracking-widest">UTILITIES FOR POWER USERS</p>
                    </div>

                    <div v-for="(app, i) in apps" :key="app.id" class="app-section min-h-screen flex items-center justify-center md:justify-end px-6 md:px-24" :data-index="i">
                        <div class="max-w-md w-full bg-black/60 backdrop-blur-xl border border-white/10 p-10 rounded-3xl hover:border-klein-blue/50 transition-colors">
                            <span class="text-klein-blue font-mono text-xs tracking-widest mb-4 block">0{{i+1}} / SYSTEM</span>
                            <h3 class="text-5xl font-bold text-white mb-6 tracking-tight">{{ app.name }}</h3>
                            <p class="text-gray-400 text-lg leading-relaxed mb-8 font-light">
                                {{ app.desc }}
                            </p>
                            <div class="flex items-center gap-3">
                                <span class="px-4 py-1.5 bg-white/5 border border-white/10 rounded-full text-xs font-mono text-gray-300">MACOS</span>
                                <span class="px-4 py-1.5 bg-white/5 border border-white/10 rounded-full text-xs font-mono text-gray-300">SWIFT</span>
                            </div>
                        </div>
                    </div>
                    <!-- Added extra space for SpaceSwitcher -->
                    <div class="h-[50vh]"></div>
                </div>
            </section>
            
            <!-- Connect Section (Syncs with Theme) -->
            <section id="connect" class="w-full py-32 px-6 md:px-12 bg-[#F2F2F7] dark:bg-[#050505] transition-colors duration-500 relative z-30">
                <div class="max-w-7xl mx-auto">
                    <div class="flex items-center gap-3 mb-16">
                        <span class="w-3 h-3 bg-klein-blue rounded-full"></span>
                        <span class="font-display font-bold tracking-widest text-xl text-black dark:text-white">CONNECT</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <a href="https://github.com/gitmichaelqiu/" target="_blank" class="group relative block h-80 overflow-hidden rounded-3xl bg-white dark:bg-[#0a0a0a] border border-gray-200 dark:border-white/10 hover:border-klein-blue transition-all duration-500">
                            <div class="absolute inset-0 bg-gradient-to-br from-gray-100 to-transparent dark:from-white/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div class="relative z-10 h-full p-10 flex flex-col justify-between">
                                <div class="flex justify-between items-start">
                                    <i data-lucide="github" class="w-12 h-12 text-gray-400 group-hover:text-black dark:group-hover:text-white transition-colors"></i>
                                    <span class="w-12 h-12 rounded-full border border-gray-200 dark:border-white/20 flex items-center justify-center group-hover:bg-klein-blue group-hover:border-klein-blue group-hover:text-white transition-all"><i data-lucide="arrow-up-right" class="w-6 h-6"></i></span>
                                </div>
                                <div><h3 class="text-4xl font-bold mb-3 text-black dark:text-white">GitHub</h3><p class="text-gray-500 group-hover:text-klein-blue transition-colors text-xl">Explore source code</p></div>
                            </div>
                        </a>
                        <a href="https://www.kaggle.com/michaelqiu0606" target="_blank" class="group relative block h-80 overflow-hidden rounded-3xl bg-white dark:bg-[#0a0a0a] border border-gray-200 dark:border-white/10 hover:border-[#20BEFF] transition-all duration-500">
                            <div class="relative z-10 h-full p-10 flex flex-col justify-between">
                                <div class="flex justify-between items-start">
                                    <div class="text-4xl font-black text-gray-400 group-hover:text-[#20BEFF] transition-colors">K</div>
                                    <span class="w-12 h-12 rounded-full border border-gray-200 dark:border-white/20 flex items-center justify-center group-hover:bg-[#20BEFF] group-hover:border-[#20BEFF] group-hover:text-white transition-all"><i data-lucide="arrow-up-right" class="w-6 h-6"></i></span>
                                </div>
                                <div><h3 class="text-4xl font-bold mb-3 text-black dark:text-white">Kaggle</h3><p class="text-gray-500 group-hover:text-[#20BEFF] transition-colors text-xl">Data Science</p></div>
                            </div>
                        </a>
                    </div>
                </div>
            </section>

            <footer class="w-full py-16 px-6 md:px-12 border-t border-gray-200 dark:border-white/10 bg-white dark:bg-black text-gray-500 flex flex-col md:flex-row justify-between items-center text-sm font-mono transition-colors duration-500 relative z-30">
                <p>&copy; 2025 MICHAEL QIU.</p>
                <div class="flex gap-8 mt-6 md:mt-0">
                    <a href="#home" class="hover:text-klein-blue transition-colors">BACK TO TOP</a>
                </div>
            </footer>
        </main>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted, watch, nextTick } = Vue;

        createApp({
            setup() {
                const isSidebarOpen = ref(false);
                const themeMode = ref('auto'); 
                const activeTheme = ref('dark'); 
                const scrollProgress = ref(0);
                const activeSection = ref('home');
                const isCapsuleOpen = ref(false);
                const loader = ref(null);
                const canvasContainer = ref(null);
                const textureError = ref(false);
                
                // Reactive Nav Color Class - FORCED BLACK ON HOME
                const navColorClass = computed(() => {
                    const darkSections = ['home', 'works'];
                    const isDarkSection = darkSections.includes(activeSection.value);
                    
                    if (isDarkSection) {
                        return 'bg-black text-white border-white/20';
                    } else {
                        return activeTheme.value === 'dark' ? 'bg-white text-black border-white/10' : 'bg-black text-white border-black/10';
                    }
                });

                const systemLinks = [
                    { name: 'HOME' }, { name: 'WRITINGS' }, { name: 'ARCHIVE' }, { name: 'LABS' }
                ];
                
                const apps = [
                    { id: 'DesktopRenamer', name: 'DesktopRenamer', desc: 'Customizes the name of your current desktop in the menubar.', img: 'resources/DesktopRenamer.png' },
                    { id: 'OptClick', name: 'OptClicker', desc: 'Simulate right-click via Option key.', img: 'resources/OptClicker.png' },
                    { id: 'SpaceSwitcher', name: 'SpaceSwitcher', desc: 'Control app visibility across specific workspaces.', img: 'resources/SpaceSwitcher.png' }
                ];

                let scene, camera, renderer, appsGroup;
                let icons = []; 
                let mouseX = 0, mouseY = 0;
                let lenis;

                const capsulePerimeter = 360; 
                const capsuleDashOffset = computed(() => {
                    // Logic to ensure ring completes 100%
                    const progress = Math.min(100, Math.max(0, scrollProgress.value));
                    return Math.max(0, capsulePerimeter - (progress / 100) * capsulePerimeter);
                });

                const toggleCapsuleNav = () => { isCapsuleOpen.value = !isCapsuleOpen.value; };
                const toggleSidebar = () => { isSidebarOpen.value = !isSidebarOpen.value; };

                watch(isSidebarOpen, (newVal) => { if (newVal) nextTick(() => lucide.createIcons()); });

                const resolveTheme = () => {
                    let resolved = 'dark';
                    if (themeMode.value === 'auto') {
                        resolved = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                    } else {
                        resolved = themeMode.value;
                    }
                    activeTheme.value = resolved;
                    if (resolved === 'dark') document.documentElement.classList.add('dark');
                    else document.documentElement.classList.remove('dark');
                };

                const cycleTheme = () => {
                    if (themeMode.value === 'auto') themeMode.value = 'light';
                    else if (themeMode.value === 'light') themeMode.value = 'dark';
                    else themeMode.value = 'auto';
                    resolveTheme();
                };

                const updateScrollProgress = () => {
                    const scrollTop = window.scrollY || document.documentElement.scrollTop;
                    const docHeight = document.documentElement.scrollHeight;
                    const winHeight = window.innerHeight;
                    const scrollTotal = docHeight - winHeight;
                    
                    let progress = scrollTotal > 0 ? (scrollTop / scrollTotal) * 100 : 0;
                    progress = Math.min(100, Math.max(0, progress));
                    scrollProgress.value = progress;
                    
                    if (isCapsuleOpen.value && Math.abs(scrollTop - (window.lastScrollY || 0)) > 10) {
                        isCapsuleOpen.value = false;
                    }
                    window.lastScrollY = scrollTop;

                    // Update Active Section
                    const sections = ['home', 'profile', 'works', 'connect'];
                    for (const section of sections) {
                        const el = document.getElementById(section);
                        if (el) {
                            const rect = el.getBoundingClientRect();
                            if (rect.top <= winHeight * 0.5 && rect.bottom >= winHeight * 0.5) {
                                activeSection.value = section;
                            }
                        }
                    }
                    
                    // Home Animation Logic (Revised)
                    const magContainer = document.getElementById('magnetic-container');
                    const heroText = document.querySelector('.hero-text-container');
                    const introText = document.querySelector('.intro-text');
                    const banner = document.getElementById('creative-banner');
                    
                    if (scrollTop < winHeight * 2) {
                        // 1. Balls Fade (Opacity) & Scale Down slightly
                        if(magContainer) {
                            magContainer.style.opacity = Math.max(0, 1 - scrollTop / 600);
                            magContainer.style.transform = `scale(${1 - scrollTop / 2000})`;
                        }
                        
                        // 2. Name Grows & Moves Up
                        if(heroText) {
                            // Parallax move up
                            const moveY = -scrollTop * 0.5;
                            // Scale up
                            const scale = 1 + scrollTop / 1000;
                            heroText.style.transform = `translateY(${moveY}px) scale(${scale})`;
                            
                            // Fade in intro text
                            if(introText) {
                                introText.style.opacity = Math.min(1, scrollTop / 300);
                            }
                        }
                        
                        // 3. Banner Expansion
                        if(banner) {
                            const bannerTriggerPoint = winHeight * 0.5;
                            if(scrollTop > bannerTriggerPoint) {
                                const progress = Math.min(1, (scrollTop - bannerTriggerPoint) / 500);
                                banner.style.transform = `scale(${0.5 + progress * 0.5})`;
                                banner.style.opacity = progress;
                            } else {
                                banner.style.opacity = 0;
                            }
                        }
                    }
                };

                const initCursor = () => {
                    const dot = document.querySelector('.cursor-dot');
                    const outline = document.querySelector('.cursor-outline');
                    if(dot && outline) {
                        window.addEventListener('mousemove', (e) => {
                            const posX = e.clientX;
                            const posY = e.clientY;
                            dot.style.left = `${posX}px`; 
                            dot.style.top = `${posY}px`;
                            outline.animate({ left: `${posX}px`, top: `${posY}px` }, { duration: 500, fill: "forwards" });
                        });
                    }
                };

                const initMagneticLogo = () => {
                    const container = document.getElementById('magnetic-container');
                    if (!container) return;
                    container.innerHTML = '';

                    const logoPaths = [
                        "M443.24,16.93l-149.03,273.93c-3.34,6.14-5.12,13.33-5.12,20.68v145.02c0,20.73,13.85,37.54,30.94,37.54h149.03c17.09,0,30.94-16.81,30.94-37.54V37.61c0-37.23-39.85-51.75-56.75-20.68Z",
                        "M232.72,17.08L5.16,435.89c-13.56,24.96,1.19,58.2,25.83,58.2H167.51c10.4,0,20.1-6.34,25.83-16.88l91.04-167.55c3.33-6.13,5.11-13.32,5.11-20.66V37.74c0-37.24-39.87-51.75-56.76-20.66Z",
                        "M841.59,437.09l-178.07-239.47c-7.36-9.89-19.53-15.81-32.53-15.81h-60.8c-21.79,0-39.45,16.3-39.45,36.4v239.47c0,20.11,17.66,36.4,39.45,36.4h238.88c31.75,0,50.49-32.84,32.53-57Z",
                        "M693.68,164.05l86.8-117.52c13.58-18.38,.45-44.39-22.4-44.39h-173.6c-22.85,0-35.98,26.01-22.4,44.39l86.8,117.52c11.13,15.07,33.67,15.07,44.8,0Z"
                    ];

                    const width = container.clientWidth;
                    const height = container.clientHeight;
                    
                    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    svg.setAttribute("width", "100%");
                    svg.setAttribute("height", "100%");
                    svg.style.overflow = "visible";
                    container.appendChild(svg);

                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');

                    // SCALE: Fit logo within screen boundaries completely
                    // We use 0.8 scale factor to leave margin
                    const logoScale = Math.min(width, height) / 500 * 0.8; 
                    const offsetX = (width - 848.58 * logoScale) / 2;
                    const offsetY = (height - 494.09 * logoScale) / 2;

                    ctx.fillStyle = "black";
                    ctx.save();
                    ctx.translate(offsetX, offsetY);
                    ctx.scale(logoScale, logoScale);
                    logoPaths.forEach(pathD => { const p = new Path2D(pathD); ctx.fill(p); });
                    ctx.restore();

                    const step = 25; // Large balls
                    const balls = [];
                    const mouseRadius = 300; 

                    for (let y = 0; y < height; y += step) {
                        for (let x = 0; x < width; x += step) {
                            const pixel = ctx.getImageData(x, y, 1, 1).data;
                            if (pixel[3] > 128) {
                                const ball = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                                // Balls are WHITE for contrast on BLUE bg
                                ball.setAttribute("class", "text-white fill-current magnetic-ball");
                                ball.setAttribute("cx", x);
                                ball.setAttribute("cy", y);
                                ball.setAttribute("r", 4); 
                                svg.appendChild(ball);
                                balls.push({ el: ball, ori_x: x, ori_y: y });
                            }
                        }
                    }

                    container.addEventListener('mousemove', (e) => {
                        const rect = container.getBoundingClientRect();
                        const mouseX = e.clientX - rect.left;
                        const mouseY = e.clientY - rect.top;
                        balls.forEach(ball => {
                            const dx = ball.ori_x - mouseX;
                            const dy = ball.ori_y - mouseY;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            if (dist < mouseRadius) {
                                const angle = Math.atan2(dy, dx);
                                const moveDist = ((mouseRadius - dist) / mouseRadius) * 80; 
                                const tx = ball.ori_x + Math.cos(angle) * moveDist;
                                const ty = ball.ori_y + Math.sin(angle) * moveDist;
                                gsap.to(ball.el, { attr: { cx: tx, cy: ty }, duration: 0.3 });
                            } else {
                                gsap.to(ball.el, { attr: { cx: ball.ori_x, cy: ball.ori_y }, duration: 0.8, ease: "elastic.out(1, 0.3)" });
                            }
                        });
                    });
                };

                const createSquircleShape = (size) => {
                    const shape = new THREE.Shape();
                    const width = size; const height = size;
                    const x = -width / 2; const y = -height / 2;
                    const r = 0.7; 
                    shape.moveTo( x, y + r );
                    shape.lineTo( x, y + height - r );
                    shape.quadraticCurveTo( x, y + height, x + r, y + height );
                    shape.lineTo( x + width - r, y + height );
                    shape.quadraticCurveTo( x + width, y + height, x + width, y + height - r );
                    shape.lineTo( x + width, y + r );
                    shape.quadraticCurveTo( x + width, y, x + width - r, y );
                    shape.lineTo( x + r, y );
                    shape.quadraticCurveTo( x, y, x, y + r );
                    return shape;
                };

                // HD Fallback Texture - IMPROVED RESOLUTION (2048x2048)
                const createFallbackTexture = (text) => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 2048; canvas.height = 2048; 
                    const ctx = canvas.getContext('2d');
                    
                    // Dark background
                    ctx.fillStyle = '#050505';
                    ctx.fillRect(0, 0, 2048, 2048);
                    
                    // Grid lines
                    ctx.strokeStyle = '#222';
                    ctx.lineWidth = 10;
                    for(let i=0; i<2048; i+=256) {
                        ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, 2048); ctx.stroke();
                        ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(2048, i); ctx.stroke();
                    }
                    
                    // Border
                    ctx.strokeStyle = '#002FA7';
                    ctx.lineWidth = 40;
                    ctx.beginPath();
                    if (ctx.roundRect) ctx.roundRect(80, 80, 1888, 1888, 300);
                    else ctx.rect(80, 80, 1888, 1888);
                    ctx.stroke();

                    // Text
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 600px "Inter", sans-serif'; // Bigger font
                    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                    ctx.fillText(text.substring(0, 2).toUpperCase(), 1024, 1024);

                    const tex = new THREE.CanvasTexture(canvas);
                    tex.anisotropy = renderer.capabilities.getMaxAnisotropy();
                    return tex;
                };

                const initThreeJS = () => {
                    if (!canvasContainer.value) return;
                    const width = canvasContainer.value.clientWidth;
                    const height = canvasContainer.value.clientHeight;

                    scene = new THREE.Scene();
                    
                    camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 100);
                    camera.position.z = 12;

                    renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                    renderer.setSize(width, height);
                    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                    renderer.toneMapping = THREE.ACESFilmicToneMapping;
                    renderer.toneMappingExposure = 1.2;
                    canvasContainer.value.appendChild(renderer.domElement);

                    appsGroup = new THREE.Group();
                    scene.add(appsGroup);

                    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5); 
                    scene.add(ambientLight);
                    const keyLight = new THREE.SpotLight(0xffffff, 2);
                    keyLight.position.set(-10, 10, 10);
                    scene.add(keyLight);
                    const backLight = new THREE.DirectionalLight(0x002FA7, 2);
                    backLight.position.set(0, 5, -10);
                    scene.add(backLight);
                    
                    const size = 3; 
                    const extrudeSettings = { depth: 0.4, bevelEnabled: true, bevelSegments: 5, steps: 1, bevelSize: 0.05, bevelThickness: 0.05 };
                    const shape = createSquircleShape(size); 
                    const geometry = new THREE.ExtrudeGeometry(shape, extrudeSettings);
                    geometry.computeBoundingBox();
                    const max = geometry.boundingBox.max; const min = geometry.boundingBox.min;
                    const range = new THREE.Vector2(max.x - min.x, max.y - min.y);
                    const uvAttribute = geometry.attributes.uv; const posAttribute = geometry.attributes.position;
                    for (let i = 0; i < posAttribute.count; i++) {
                        const x = posAttribute.getX(i); const y = posAttribute.getY(i);
                        uvAttribute.setXY(i, (x - min.x) / range.x, (y - min.y) / range.y);
                    }
                    geometry.attributes.uv.needsUpdate = true;
                    geometry.center();

                    const texLoader = new THREE.TextureLoader();

                    apps.forEach((app, i) => {
                        const sideMaterial = new THREE.MeshPhysicalMaterial({
                            color: 0x001133, roughness: 0.2, metalness: 0.8,
                        });
                        const frontMaterial = new THREE.MeshStandardMaterial({
                            color: 0xffffff, roughness: 0.4, metalness: 0.1
                        });

                        texLoader.load(app.img, 
                            (texture) => {
                                texture.encoding = THREE.sRGBEncoding;
                                texture.anisotropy = renderer.capabilities.getMaxAnisotropy();
                                frontMaterial.map = texture;
                                frontMaterial.needsUpdate = true;
                            },
                            undefined,
                            () => {
                                const fallback = createFallbackTexture(app.name);
                                frontMaterial.map = fallback;
                                frontMaterial.needsUpdate = true;
                            }
                        );

                        const mesh = new THREE.Mesh(geometry, [frontMaterial, sideMaterial]);
                        mesh.position.set(0, -10, 0); 
                        appsGroup.add(mesh);
                        icons.push(mesh);
                    });

                    document.addEventListener('mousemove', (event) => {
                        mouseX = (event.clientX - window.innerWidth / 2) * 0.0005;
                        mouseY = (event.clientY - window.innerHeight / 2) * 0.0005;
                    });

                    window.addEventListener('resize', () => {
                        if(!canvasContainer.value) return;
                        const w = canvasContainer.value.clientWidth;
                        const h = canvasContainer.value.clientHeight;
                        camera.aspect = w / h;
                        camera.updateProjectionMatrix();
                        renderer.setSize(w, h);
                    });

                    const animate = () => {
                        requestAnimationFrame(animate);
                        icons.forEach((icon, i) => {
                            icon.rotation.x += 0.05 * (mouseY * 2 - icon.rotation.x);
                            icon.rotation.y += 0.05 * (mouseX * 2 - icon.rotation.y);
                        });
                        renderer.render(scene, camera);
                    };
                    animate();

                    const sections = document.querySelectorAll('.app-section');
                    sections.forEach((section, index) => {
                        ScrollTrigger.create({
                            trigger: section,
                            start: "top center",
                            end: "bottom center",
                            onEnter: () => animateIconIn(index),
                            onEnterBack: () => animateIconIn(index),
                            onLeave: () => animateIconOut(index, 1),
                            onLeaveBack: () => animateIconOut(index, -1)
                        });
                    });
                };

                const animateIconIn = (index) => {
                    const icon = icons[index];
                    if(!icon) return;
                    gsap.to(icon.position, { y: 0, duration: 1, ease: "power3.out" });
                    gsap.to(icon.scale, { x: 1, y: 1, z: 1, duration: 1, ease: "elastic.out(1, 0.8)" });
                    gsap.to(icon.rotation, { x: 0, y: 0, z: 0, duration: 1 });
                };

                const animateIconOut = (index, direction) => {
                    const icon = icons[index];
                    if(!icon) return;
                    const targetY = direction > 0 ? 10 : -10; 
                    gsap.to(icon.position, { y: targetY, duration: 0.8, ease: "power3.in" });
                    gsap.to(icon.scale, { x: 0.5, y: 0.5, z: 0.5, duration: 0.8 });
                };

                const initLenis = () => {
                    lenis = new Lenis({
                        duration: 2.0, 
                        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
                        direction: 'vertical',
                        gestureDirection: 'vertical',
                        smooth: true,
                        mouseMultiplier: 0.8,
                        smoothTouch: false,
                        touchMultiplier: 2,
                    });
                    function raf(time) {
                        lenis.raf(time);
                        requestAnimationFrame(raf);
                    }
                    requestAnimationFrame(raf);
                };

                onMounted(() => {
                    setTimeout(() => {
                        if(loader.value) {
                            loader.value.style.opacity = '0';
                            setTimeout(() => { loader.value.style.display = 'none'; }, 500);
                        }
                        gsap.from(".hero-text-container", { y: 100, opacity: 0, duration: 1.2, ease: "power4.out", delay: 0.5 });
                        initMagneticLogo();
                    }, 1500);

                    lucide.createIcons();
                    resolveTheme(); 
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', resolveTheme);
                    initThreeJS();
                    initCursor();
                    initLenis(); 
                    window.addEventListener('scroll', updateScrollProgress);
                });
                
                onUnmounted(() => {
                    window.removeEventListener('scroll', updateScrollProgress);
                    window.matchMedia('(prefers-color-scheme: dark)').removeEventListener('change', resolveTheme);
                    if(lenis) lenis.destroy();
                });

                return {
                    isSidebarOpen, themeMode, activeTheme, scrollProgress, activeSection, isCapsuleOpen, capsulePerimeter, capsuleDashOffset, toggleSidebar, toggleCapsuleNav, cycleTheme, loader, canvasContainer, apps, systemLinks, textureError, navColorClass
                };
            }
        }).mount('#app');
    </script>
</body>
</html>