<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Michael Qiu | A Development Enthusiast</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    colors: {
                        'klein-blue': '#002FA7',
                        'bg-dark': '#050505',
                        'bg-light': '#F2F2F7', 
                        'deep-navy': '#020412',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        display: ['Syncopate', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>

    <!-- Lenis (Smooth Scroll) -->
    <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&family=JetBrains+Mono:wght@400;700&family=Syncopate:wght@700;800&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            --klein-blue: #002FA7;
        }

        body {
            background-color: #F2F2F7;
            color: #111;
            transition: background 0.5s ease, color 0.5s ease;
            width: 100vw;
            overflow-x: hidden;
        }

        html.dark body {
            background-color: #050505;
            color: #ffffff;
        }

        /* Lenis */
        html.lenis { height: auto; }
        .lenis.lenis-smooth { scroll-behavior: auto; }
        .lenis.lenis-smooth [data-lenis-prevent] { overscroll-behavior: contain; }
        .lenis.lenis-stopped { overflow: hidden; }
        .lenis.lenis-scrolling iframe { pointer-events: none; }

        /* Custom Cursor - FIXED VISIBILITY */
        @media (hover: hover) and (pointer: fine) {
            body, button, a, input, [role="button"], .cursor-pointer { cursor: none !important; }
            .cursor-dot, .cursor-outline { display: block; }
        }
        .cursor-dot, .cursor-outline {
            position: fixed; top: 0; left: 0;
            transform: translate(-50%, -50%); border-radius: 50%;
            z-index: 20000; pointer-events: none; mix-blend-mode: difference;
        }
        .cursor-dot { width: 8px; height: 8px; background-color: white; }
        .cursor-outline { width: 40px; height: 40px; border: 1px solid white; transition: width 0.2s, height 0.2s; }
        body:hover .cursor-outline { width: 30px; height: 30px; }

        /* Typography */
        .outline-text { color: transparent; -webkit-text-stroke: 1px rgba(255, 255, 255, 0.5); }
        
        /* Glass Cards */
        .glass-card { background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(0, 0, 0, 0.1); transition: all 0.3s ease; }
        html.dark .glass-card { background: rgba(20, 20, 20, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-card:hover { border-color: var(--klein-blue); background: rgba(0, 47, 167, 0.05); }

        /* Card Glows */
        .card-corner-glow {
            position: absolute; top: 0; right: 0; width: 300px; height: 300px;
            background: radial-gradient(circle at 100% 0%, rgba(0, 47, 167, 0.4) 0%, transparent 70%); 
            opacity: 0; transition: opacity 0.6s ease; pointer-events: none; z-index: 0;
        }
        .group:hover .card-corner-glow { opacity: 1; }
        
        /* Ambient Glow */
        .ambient-glow {
            position: absolute; width: 40vmax; height: 40vmax;
            background: radial-gradient(circle, rgba(0, 47, 167, 0.15) 0%, transparent 70%);
            filter: blur(80px); border-radius: 50%; pointer-events: none; z-index: 0; opacity: 0.6;
        }

        /* App Card Styles */
        .app-card-glass {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.6) 100%);
            backdrop-filter: blur(60px) saturate(180%); -webkit-backdrop-filter: blur(60px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 30px 60px -10px rgba(0,0,0,0.1), inset 0 0 0 1px rgba(255,255,255,0.2);
            transform: translateZ(0); will-change: transform, backdrop-filter;
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        html.dark .app-card-glass {
            background: linear-gradient(180deg, rgba(30, 30, 35, 0.7) 0%, rgba(10, 10, 15, 0.6) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 40px 80px -15px rgba(0,0,0,0.6), inset 0 0 0 1px rgba(255,255,255,0.05);
        }
        .app-card-glass:hover { transform: translateY(-8px) scale(1.01) translateZ(0); box-shadow: 0 50px 100px -20px rgba(0, 47, 167, 0.25); }
        html.dark .app-card-glass:hover { border-color: rgba(255, 255, 255, 0.2); box-shadow: 0 50px 100px -20px rgba(0, 47, 167, 0.3); }

        /* --- PHOTOS SECTION STYLES --- */
        
        /* Theme Transition - Default to Intro State (Dark) */
        #photos { 
            transition: background-color 0.5s ease; /* Smoother transition */
            background-color: #050505; /* Start Dark for Intro */
            color: #ffffff;
        }
        
        /* Active Photo State - Applied via JS after capture */
        #photos.photos-active.light-mode { background-color: #ffffff; color: #002FA7; }
        #photos.photos-active.dark-mode { background-color: #020412; color: #ffffff; }
        
        /* Text Colors based on active state */
        #photos.photos-active.light-mode .gallery-title { color: #002FA7; opacity: 0.15; }
        #photos.photos-active.light-mode .gallery-quote { color: #002FA7; }
        #photos.photos-active.dark-mode .gallery-title { color: rgba(255, 255, 255, 0.1); }

        /* Wave Component Styles */
        a-waves {
            --x: -0.5rem;
            --y: 50%;
            /* Fix: Initialize variable for dash offset */
            --dash-offset: 4000;
            position: absolute;
            top: 0;
            left: 0;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none; 
            z-index: 0;
        }
        
        a-waves:before {
            content: none !important;
            display: none !important;
        }

        a-waves svg {
            display: block;
            width: 100%;
            height: 100%;
        }

        a-waves svg path {
            fill: none;
            stroke-width: 1px;
            vector-effect: non-scaling-stroke;
            transition: stroke 0.5s ease;
            stroke-dasharray: 4000; 
            /* Fix: Bind to CSS Variable so animation persists across redraws */
            stroke-dashoffset: var(--dash-offset); 
        }
        
        /* Wave Stroke Colors */
        #photos.photos-active.light-mode a-waves svg path { stroke: rgba(0, 47, 167, 0.2); }
        /* Default / Dark Mode stroke */
        a-waves svg path { stroke: rgba(255, 255, 255, 0.2); }

        /* --- NEW HOVER EFFECTS --- */
        .photos-grid:hover .photo-card-vertical {
            opacity: 0.2;
            filter: grayscale(100%) blur(2px);
            transform: scale(0.98);
        }
        .photos-grid .photo-card-vertical:hover {
            opacity: 1;
            filter: grayscale(0%) blur(0px);
            transform: scale(1.05) translateY(-10px);
            z-index: 50;
            box-shadow: 0 40px 80px rgba(0, 47, 167, 0.3);
            border-color: rgba(0, 47, 167, 0.8);
        }
        .photo-card-vertical {
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            transform: translateY(0);
            border: 1px solid transparent;
            /* Important for JS manipulation: */
            will-change: transform, opacity;
        }
        
        .gallery-title {
            transform-origin: center center;
            will-change: transform, opacity, filter, clip-path;
        }

        /* --- HUD & FLASH --- */
        .camera-hud { pointer-events: none; transition: opacity 0.5s ease; }
        .camera-corner {
            position: absolute; width: 40px; height: 40px;
            border-color: rgba(255, 255, 255, 0.7); border-style: solid;
            transition: all 0.5s ease;
        }
        .tl { top: 40px; left: 40px; border-width: 2px 0 0 2px; }
        .tr { top: 40px; right: 40px; border-width: 2px 2px 0 0; }
        .bl { bottom: 40px; left: 40px; border-width: 0 0 2px 2px; }
        .br { bottom: 40px; right: 40px; border-width: 0 2px 2px 0; }
        
        .camera-btn-container {
            pointer-events: auto; cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease;
        }
        .camera-btn-container:hover { transform: scale(1.1); }
        .camera-btn-inner {
            width: 60px; height: 60px; border-radius: 50%;
            background: rgba(255, 255, 255, 0.2); border: 2px solid white;
            display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(4px);
        }
        .camera-btn-dot { width: 48px; height: 48px; background: #fff; border-radius: 50%; transition: background 0.3s; }
        .camera-btn-container:hover .camera-btn-dot { background: #002FA7; }
        
        .flash-overlay {
            position: fixed; inset: 0; background: white; z-index: 10000;
            pointer-events: none; opacity: 0; mix-blend-mode: overlay;
        }

        .nav-glass {
            background: rgba(150, 150, 150, 0.1); 
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: width 0.3s ease, background 0.3s ease, color 0.2s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

    </style>
</head>
<body>
    <div id="app" class="relative min-h-screen selection:bg-white selection:text-klein-blue">
        
        <div class="cursor-dot hidden md:block"></div>
        <div class="cursor-outline hidden md:block"></div>
        
        <!-- Flash Overlay -->
        <div class="flash-overlay" ref="flashOverlay"></div>

        <div class="loader" ref="loader">
            <div class="font-mono text-xs tracking-[0.5em] text-white/70 animate-pulse">SYSTEM_BOOT</div>
        </div>

        <nav ref="navBar" 
             class="fixed top-0 left-0 w-full z-[9990] px-6 py-6 md:px-10 md:py-8 flex justify-between items-center pointer-events-none transition-opacity duration-1000"
             :class="{ 'opacity-0 pointer-events-none': isBooting, 'opacity-100': !isBooting }">
            
            <button @click="toggleSidebar" ref="navBtnLeft" class="nav-glass group w-12 h-12 rounded-full flex flex-col justify-center items-center gap-1.5 pointer-events-auto hover:scale-105 transition-transform" :class="navLeftColor">
                <div class="flex flex-col items-center justify-center gap-1.5 w-full h-full">
                    <span class="w-5 h-0.5 bg-current transition-all duration-300 group-hover:w-7"></span>
                    <span class="w-7 h-0.5 bg-current transition-all duration-300 group-hover:w-5"></span>
                </div>
            </button>
            
            <div class="absolute left-1/2 -translate-x-1/2 pointer-events-auto z-50"
                 ref="navCapsule"
                 @click="toggleCapsuleNav"
                 @mouseenter="isCapsuleOpen = true" 
                 @mouseleave="isCapsuleOpen = false">
                <div class="nav-glass rounded-full h-12 flex items-center justify-center overflow-hidden"
                     :class="[isCapsuleOpen ? 'w-[400px]' : 'w-[160px]', navCapsuleColor]">
                    
                    <div class="w-full h-full flex items-center justify-center">
                        <div v-if="!isCapsuleOpen" class="font-mono text-xs font-bold tracking-[0.2em] px-6 animate-fade-in">
                            {{ activeSection.toUpperCase() }}
                        </div>
                        <div v-else class="flex gap-5 font-mono text-[10px] font-bold px-6 animate-fade-in whitespace-nowrap">
                            <a href="#home" class="hover:opacity-60 transition-opacity">HOME</a>
                            <span>/</span>
                            <a href="#profile" class="hover:opacity-60 transition-opacity">PROFILE</a>
                            <span>/</span>
                            <a href="#works" class="hover:opacity-60 transition-opacity">WORKS</a>
                            <span>/</span>
                            <a href="#photos" class="hover:opacity-60 transition-opacity">PHOTOS</a>
                            <span>/</span>
                            <a href="#connect" class="hover:opacity-60 transition-opacity">CONNECT</a>
                        </div>
                    </div>
                </div>
                <svg class="absolute top-0 left-0 w-full h-full pointer-events-none" style="overflow: visible;" :class="navCapsuleColor">
                    <rect x="0" y="0" width="100%" height="100%" rx="24" ry="24" fill="none" stroke="transparent" stroke-width="2" />
                     <rect x="0" y="0" width="100%" height="100%" rx="24" ry="24" fill="none" stroke="currentColor" stroke-width="2"
                          :stroke-dasharray="capsulePerimeter" :stroke-dashoffset="capsuleDashOffset"
                          class="opacity-100" style="transition: stroke-dashoffset 0.1s linear;" />
                </svg>
            </div>

            <div class="pointer-events-auto">
                <button @click="cycleTheme" ref="navBtnRight" class="nav-glass w-12 h-12 rounded-full flex items-center justify-center hover:rotate-180 hover:scale-105 transition-transform" :class="navRightColor">
                    <div class="flex items-center justify-center w-full h-full">
                        <span v-show="themeMode === 'light'" class="animate-fade-in"><i data-lucide="sun" class="w-5 h-5"></i></span>
                        <span v-show="themeMode === 'dark'" class="animate-fade-in"><i data-lucide="moon" class="w-5 h-5"></i></span>
                        <span v-show="themeMode === 'auto'" class="animate-fade-in"><i data-lucide="monitor" class="w-5 h-5"></i></span>
                    </div>
                </button>
            </div>
        </nav>

        <transition name="backdrop">
            <div v-if="isSidebarOpen" @click="toggleSidebar" class="fixed inset-0 bg-black/60 backdrop-blur-md z-[10000]"></div>
        </transition>

        <transition name="sidebar">
            <aside v-if="isSidebarOpen" class="fixed top-0 left-0 w-full md:w-[40vw] h-full bg-[#F2F2F7] dark:bg-[#080808] text-black dark:text-white z-[10001] border-r border-gray-200 dark:border-white/10 flex flex-col shadow-2xl overflow-y-auto overflow-x-hidden" style="container-type: inline-size;">
                <button @click="toggleSidebar" class="absolute top-8 left-8 md:left-12 w-12 h-12 flex items-center justify-center border-2 border-gray-200 dark:border-white/10 rounded-full hover:border-klein-blue hover:text-white hover:bg-klein-blue transition-all duration-300 z-50">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
                <div class="flex flex-col gap-8 relative z-10 mt-48 w-full">
                    <div class="font-mono text-sm text-klein-blue mb-4 tracking-[0.3em] font-bold pl-8 md:pl-12">SYSTEM MAP</div>
                    <a v-for="(link, index) in systemLinks" :key="link.name" href="#" class="group flex items-center gap-6 font-black text-transparent bg-clip-text bg-gradient-to-r from-gray-900 via-gray-500 to-gray-900 dark:from-white dark:via-gray-400 dark:to-white hover:to-klein-blue transition-all duration-500 py-2 pl-8 md:pl-12 pr-12 block w-full leading-none" style="-webkit-text-stroke: 1px rgba(128,128,128,0.2); font-size: clamp(2rem, 8cqi, 5rem);">
                        <span class="font-mono text-sm text-klein-blue opacity-50 group-hover:opacity-100 transition-opacity translate-y-2" style="font-size: 1rem;">0{{index+1}}</span>
                        <span class="group-hover:translate-x-6 transition-transform duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] break-words">{{ link.name }}</span>
                        <span class="opacity-0 -ml-8 group-hover:ml-0 group-hover:opacity-100 transition-all duration-500 delay-100"><i data-lucide="arrow-right" class="w-8 h-8 text-klein-blue"></i></span>
                    </a>
                </div>
            </aside>
        </transition>

        <main class="transition-all duration-500" :class="{ 'scale-95 opacity-50 blur-sm pointer-events-none grayscale': isSidebarOpen }">
            
            <!-- Hero Section -->
            <section id="home" class="relative w-full h-[300vh] bg-klein-blue text-white">
                <div class="sticky top-0 w-full h-screen overflow-hidden">
                    <div class="absolute inset-0 z-0 flex items-center justify-center pointer-events-auto" id="magnetic-wrapper">
                         <div id="magnetic-container" class="w-full h-full relative cursor-crosshair"></div>
                    </div>
                    <div class="absolute inset-0 z-10 flex flex-col justify-end items-start pointer-events-none">
                        <div class="absolute bottom-0 left-0 w-full h-[60vh] bg-gradient-to-t from-klein-blue/90 via-klein-blue/40 to-transparent pointer-events-none"></div>
                        <div class="hero-text-container w-full px-6 md:px-12 pb-32 md:pb-24 flex flex-col items-start transition-transform duration-75 ease-out origin-bottom-left z-20 opacity-0">
                            <div class="relative">
                                <h1 class="text-[8vw] leading-none font-black tracking-tighter text-white mix-blend-normal whitespace-nowrap" id="hero-name">
                                    MICHAEL QIU
                                </h1>
                                <div id="temp-underline" class="absolute bottom-0 left-0 w-full h-[0.3vw] bg-white origin-left transform scale-x-100 transition-opacity duration-300"></div>
                            </div>
                            <div class="intro-text opacity-0 mt-6 pl-2 w-full max-w-[85vw] md:max-w-xl transition-opacity duration-500 relative pr-4">
                                <p class="text-base md:text-2xl font-light leading-relaxed break-words whitespace-normal">
                                    Development is not a science; it is an <span class="font-bold italic text-white/90">art</span>.
                                </p>
                            </div>
                        </div>
                        <div class="scroll-hint absolute bottom-8 right-8 flex flex-col items-end gap-2 font-mono text-xs opacity-70 animate-pulse z-20">
                            <span>SCROLL TO BEGIN</span>
                            <i data-lucide="arrow-down" class="w-4 h-4"></i>
                        </div>
                    </div>
                </div>
            </section>

            <!-- About Banner -->
            <section class="w-full h-[120vh] bg-[#020202] text-white flex items-center justify-center relative overflow-hidden z-20">
                <div class="w-full transform scale-50 opacity-0 transition-transform duration-100 ease-out" id="creative-banner">
                    <h2 class="text-[12vw] font-black text-center leading-none tracking-tighter text-white mix-blend-difference">
                        ABOUT<br>ME
                    </h2>
                </div>
            </section>

            <!-- Profile Section -->
            <section id="profile" class="w-full py-32 px-6 md:px-12 relative bg-[#F2F2F7] dark:bg-[#050505] z-30 overflow-hidden">
                <div class="ambient-glow top-[-10%] right-[-10%] opacity-40"></div>
                <div class="ambient-glow bottom-[-10%] left-[-10%] opacity-30 animate-pulse-slow"></div>

                <div class="max-w-[90vw] mx-auto relative z-10">
                    <div class="flex items-end justify-between mb-24 border-b border-gray-200 dark:border-white/10 pb-8">
                        <h2 class="text-3xl font-light text-gray-500">The Architect</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6 auto-rows-[minmax(220px,auto)]">
                        <div class="col-span-1 md:col-span-2 lg:col-span-2 row-span-2 glass-card p-10 flex flex-col justify-between relative overflow-hidden group">
                             <div class="card-corner-glow"></div>
                             <div class="card-content">
                                 <h3 class="font-mono text-xs text-klein-blue mb-6 tracking-widest border border-klein-blue/30 inline-block px-3 py-1 rounded-full">ABOUT_ME</h3>
                                 <p class="text-2xl md:text-3xl font-light leading-snug text-gray-900 dark:text-gray-100">
                                     I don't just write code; <span class="font-bold border-b-2 border-klein-blue">I design workflows.</span> My background in C++ and Python allows me to build rigorous back-end systems.
                                 </p>
                             </div>
                             <div class="mt-12 flex justify-between items-end border-t border-gray-200 dark:border-white/10 pt-6 card-content">
                                 <div><span class="block font-mono text-xs text-gray-500 mb-1">LOCATION</span><span class="font-bold text-xl text-black dark:text-white">127.0.0.1</span></div>
                                 <i data-lucide="map-pin" class="w-6 h-6 text-klein-blue"></i>
                             </div>
                        </div>
                        
                        <div class="col-span-1 md:col-span-1 glass-card p-8 flex flex-col justify-between hover-solid-blue transition-all duration-300 group">
                            <div class="flex justify-between items-start card-content"><h3 class="font-mono text-xs opacity-60 text-black dark:text-white group-hover:text-white">STACK</h3><i data-lucide="layers" class="w-6 h-6 opacity-60 text-black dark:text-white group-hover:text-white"></i></div>
                            <ul class="space-y-3 mt-4 font-bold text-2xl text-black dark:text-white group-hover:text-white card-content"><li>C++</li><li>Python</li><li>SwiftUI</li></ul>
                        </div>
                        
                        <div class="col-span-1 md:col-span-1 glass-card p-8 flex flex-col justify-between hover-solid-gray transition-all duration-300 group">
                            <div class="flex justify-between items-start card-content"><h3 class="font-mono text-xs opacity-60 text-black dark:text-white group-hover:text-white">FOCUS</h3><i data-lucide="crosshair" class="w-6 h-6 opacity-60 text-black dark:text-white group-hover:text-white"></i></div>
                             <div class="mt-4 card-content"><p class="text-4xl font-black leading-none text-black dark:text-white group-hover:text-white">System<br>Utils</p></div>
                        </div>
                        
                        <div class="col-span-1 md:col-span-2 lg:col-span-2 row-span-1 glass-card p-10 flex flex-col justify-center relative overflow-hidden group border-l-4 border-l-klein-blue">
                             <div class="card-corner-glow"></div>
                             <div class="card-content">
                                 <h3 class="font-mono text-xs text-gray-500 mb-4 relative z-10">PHILOSOPHY</h3>
                                 <p class="text-2xl md:text-3xl font-serif italic text-gray-800 dark:text-gray-200 relative z-10 leading-tight">"Give people wonderful tools, and they'll do wonderful things."</p>
                                 <p class="text-right text-sm font-bold mt-4 text-klein-blue relative z-10">— Steve Jobs</p>
                             </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Works Section -->
            <section id="works" class="relative bg-[#050505] z-30">
                <div class="sticky top-0 w-full h-screen flex items-center justify-center overflow-hidden z-0">
                    <div class="w-full h-full" ref="canvasContainer"></div>
                </div>
                
                <div class="absolute top-1/4 right-0 works-page-glow"></div>
                <div class="absolute bottom-1/4 left-0 works-page-glow"></div>

                <div class="relative z-10">
                    <div class="min-h-screen flex flex-col justify-start pt-40 md:pt-60 items-center pointer-events-none">
                        <h2 class="text-6xl md:text-8xl font-black text-white tracking-tighter mb-4 mix-blend-difference">WORKS</h2>
                        <p class="font-mono text-klein-blue tracking-widest">UTILITIES FOR POWER USERS</p>
                    </div>

                    <!-- App Sections -->
                    <div v-for="(app, i) in apps" :key="app.id" class="app-section min-h-screen flex items-center px-6 md:px-24" :data-index="i">
                        <div class="hidden md:block w-1/2 h-full"></div>
                        <div class="w-full md:w-1/2 flex justify-center md:justify-end">
                            <div class="app-card-glass w-full max-w-2xl rounded-[2.5rem] p-8 md:p-12 relative group overflow-hidden cursor-pointer backdrop-blur-3xl">
                                <div class="card-corner-glow"></div>
                                <div class="card-content flex flex-col gap-8" style="container-type: inline-size;">
                                    <div class="flex items-center gap-4">
                                        <span class="font-display font-bold text-3xl text-black/20 dark:text-white/30 group-hover:text-klein-blue transition-colors">0{{i+1}}</span>
                                        <span class="font-mono text-[10px] tracking-[0.2em] text-gray-600 dark:text-gray-400 uppercase">System Utility</span>
                                    </div>
                                    <div>
                                        <h3 class="font-black text-gray-900 dark:text-white mb-6 tracking-tighter leading-[0.9] break-words" style="font-size: clamp(2rem, 11cqi, 3.75rem);">{{ app.name }}</h3>
                                        <p class="text-gray-600 dark:text-gray-400 text-lg leading-relaxed font-light">{{ app.desc }}</p>
                                    </div>
                                    <div class="pt-6 mt-4 border-t border-black/10 dark:border-white/5 flex items-center justify-between">
                                        <div class="flex gap-2">
                                            <span class="px-3 py-1 bg-black/5 dark:bg-white/5 border border-black/10 dark:border-white/10 rounded-full text-[10px] font-mono text-gray-600 dark:text-gray-400">MACOS</span>
                                            <span class="px-3 py-1 bg-black/5 dark:bg-white/5 border border-black/10 dark:border-white/10 rounded-full text-[10px] font-mono text-gray-600 dark:text-gray-400">SWIFT</span>
                                        </div>
                                        <button class="flex items-center gap-2 px-6 py-3 rounded-full bg-white/20 dark:bg-black/20 backdrop-blur-xl border border-black/10 dark:border-white/20 shadow-lg text-gray-900 dark:text-white font-bold text-sm hover:scale-105 hover:bg-white/40 dark:hover:bg-white/10 transition-all duration-300">
                                            <span>View</span>
                                            <i data-lucide="arrow-right" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- NEW PHOTOS SECTION -->
            <section id="photos" class="relative z-30 overflow-hidden h-screen" :class="[photosActive ? 'photos-active' : '', activeTheme === 'light' ? 'light-mode' : 'dark-mode']">
                <!-- Sticky Container -->
                <div class="sticky top-0 h-screen w-full flex flex-col justify-center overflow-hidden">
                    <!-- Background Wave Effect -->
                    <a-waves class="absolute inset-0 z-0 js-waves-container">
                        <svg class="js-svg"></svg>
                    </a-waves>

                    <!-- Camera HUD -->
                    <div class="camera-hud absolute inset-0 z-40 flex flex-col items-center justify-center opacity-0" :class="{'pointer-events-none': photosActive}">
                        <div class="camera-corner tl"></div>
                        <div class="camera-corner tr"></div>
                        <div class="camera-corner bl"></div>
                        <div class="camera-corner br"></div>
                        
                        <!-- Camera Button -->
                        <div class="camera-btn-container" ref="cameraBtn" @click="handleCaptureClick">
                            <div class="camera-btn-inner">
                                <div class="camera-btn-dot"></div>
                            </div>
                            <div class="mt-4 font-mono text-xs tracking-widest text-white/50 text-center">CAPTURE</div>
                        </div>
                    </div>

                    <div class="relative z-10 px-6 md:px-12 max-w-[95vw] mx-auto w-full h-full flex flex-col justify-center items-center pointer-events-none">
                        
                        <!-- Phase 1 & 2: HUGE Title -->
                        <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-20">
                            <!-- Adjusted Scale and added clip-path for shutter effect -->
                            <h2 class="gallery-title text-[15vw] md:text-[18vw] font-black tracking-tighter leading-none origin-center opacity-0" style="transform: scaleY(3); filter: blur(10px); clip-path: inset(0 100% 0 100%);">
                                GALLERY
                            </h2>
                        </div>

                        <!-- Phase 3: Quote -->
                        <div class="gallery-quote absolute z-30 text-center opacity-0 max-w-2xl px-6">
                            <p class="font-serif italic text-3xl md:text-5xl leading-tight mb-6">
                                "Photography is the story I fail to put into words."
                            </p>
                            <p class="font-mono text-xs tracking-[0.3em] uppercase opacity-60">— Destin Sparks</p>
                        </div>

                        <!-- Phase 4: Vertical Masonry Grid -->
                        <div class="photos-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 md:gap-12 w-full translate-y-[150vh] opacity-0 relative z-10 mt-32 md:mt-0 pointer-events-auto" style="padding-top: 20vh;">
                            
                            <!-- Col 1 -->
                            <div class="flex flex-col gap-12 mt-0">
                                <div v-for="(photo, index) in photos.slice(0, 2)" :key="index" class="photo-card-vertical group relative w-full aspect-[3/4] overflow-hidden rounded-sm bg-neutral-900 shadow-2xl">
                                    <img :src="photo.url" class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" alt="Gallery Image">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-8">
                                        <span class="font-mono text-xs tracking-widest text-klein-blue mb-2">{{ photo.date }}</span>
                                        <h3 class="font-bold text-2xl tracking-tight leading-none text-white">{{ photo.title }}</h3>
                                    </div>
                                </div>
                            </div>

                            <!-- Col 2 (Offset) -->
                            <div class="flex flex-col gap-12 md:mt-24">
                                <div v-for="(photo, index) in photos.slice(2, 4)" :key="index" class="photo-card-vertical group relative w-full aspect-[3/4] overflow-hidden rounded-sm bg-neutral-900 shadow-2xl">
                                    <img :src="photo.url" class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" alt="Gallery Image">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-8">
                                        <span class="font-mono text-xs tracking-widest text-klein-blue mb-2">{{ photo.date }}</span>
                                        <h3 class="font-bold text-2xl tracking-tight leading-none text-white">{{ photo.title }}</h3>
                                    </div>
                                </div>
                            </div>

                            <!-- Col 3 (More Offset + Entry) -->
                            <div class="flex flex-col gap-12 md:mt-48">
                                <div v-for="(photo, index) in photos.slice(4, 5)" :key="index" class="photo-card-vertical group relative w-full aspect-[3/4] overflow-hidden rounded-sm bg-neutral-900 shadow-2xl">
                                    <img :src="photo.url" class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" alt="Gallery Image">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-8">
                                        <span class="font-mono text-xs tracking-widest text-klein-blue mb-2">{{ photo.date }}</span>
                                        <h3 class="font-bold text-2xl tracking-tight leading-none text-white">{{ photo.title }}</h3>
                                    </div>
                                </div>

                                <!-- View Full Gallery Entry -->
                                <a href="#" class="photo-card-vertical group relative w-full aspect-square bg-[#111] border border-white/10 flex flex-col items-center justify-center overflow-hidden hover:border-klein-blue transition-colors duration-500 shadow-2xl">
                                    <div class="absolute inset-0 bg-klein-blue/5 scale-0 group-hover:scale-100 transition-transform duration-500 rounded-full blur-3xl"></div>
                                    <div class="w-20 h-20 rounded-full border border-white/20 flex items-center justify-center mb-6 group-hover:bg-klein-blue group-hover:border-klein-blue group-hover:scale-110 transition-all duration-300 relative z-10">
                                        <i data-lucide="arrow-right" class="w-8 h-8 text-white"></i>
                                    </div>
                                    <h3 class="font-display text-2xl font-bold tracking-tighter relative z-10 text-white">VIEW ALL</h3>
                                    <p class="font-mono text-xs text-gray-500 mt-2 group-hover:text-white/80 relative z-10">ENTER GALLERY</p>
                                </a>
                            </div>

                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Connect Section -->
            <section id="connect" class="w-full min-h-screen flex flex-col justify-center items-center py-32 px-6 md:px-12 bg-[#F2F2F7] dark:bg-[#050505] transition-colors duration-500 relative z-30 overflow-hidden">
                <div class="ambient-glow top-[10%] left-[10%] opacity-50 bg-[#002FA7]"></div>
                <div class="ambient-glow bottom-[10%] right-[10%] opacity-30 bg-[#20BEFF] animate-pulse-slow"></div>

                <div class="max-w-7xl mx-auto w-full relative z-10">
                    <div class="flex items-center justify-center gap-3 mb-16 w-full text-center">
                        <span class="w-3 h-3 bg-klein-blue rounded-full"></span>
                        <span class="font-display font-bold tracking-widest text-xl text-black dark:text-white">CONNECT</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <a href="https://github.com/gitmichaelqiu/" target="_blank" class="group relative block h-80 overflow-hidden rounded-3xl bg-white dark:bg-[#0a0a0a] border border-gray-200 dark:border-white/10 transition-all duration-500">
                            <div class="card-corner-glow"></div>
                            <div class="relative z-10 h-full p-10 flex flex-col justify-between card-content">
                                <div class="flex justify-between items-start">
                                    <i data-lucide="github" class="w-12 h-12 text-gray-400 group-hover:text-black dark:group-hover:text-white transition-colors"></i>
                                    <span class="w-12 h-12 rounded-full border border-gray-200 dark:border-white/20 flex items-center justify-center group-hover:bg-klein-blue group-hover:border-klein-blue group-hover:text-white transition-all"><i data-lucide="arrow-up-right" class="w-6 h-6"></i></span>
                                </div>
                                <div><h3 class="text-4xl font-bold mb-3 text-black dark:text-white">GitHub</h3><p class="text-gray-500 group-hover:text-klein-blue transition-colors text-xl">Explore source code</p></div>
                            </div>
                        </a>
                        <a href="https://www.kaggle.com/michaelqiu0606" target="_blank" class="group relative block h-80 overflow-hidden rounded-3xl bg-white dark:bg-[#0a0a0a] border border-gray-200 dark:border-white/10 transition-all duration-500">
                            <div class="card-corner-glow" style="background: radial-gradient(circle at 100% 0%, rgba(32, 190, 255, 0.6) 0%, transparent 60%);"></div>
                            <div class="relative z-10 h-full p-10 flex flex-col justify-between card-content">
                                <div class="flex justify-between items-start">
                                    <div class="text-4xl font-black text-gray-400 group-hover:text-[#20BEFF] transition-colors">K</div>
                                    <span class="w-12 h-12 rounded-full border border-gray-200 dark:border-white/20 flex items-center justify-center group-hover:bg-[#20BEFF] group-hover:border-[#20BEFF] group-hover:text-white transition-all"><i data-lucide="arrow-up-right" class="w-6 h-6"></i></span>
                                </div>
                                <div><h3 class="text-4xl font-bold mb-3 text-black dark:text-white">Kaggle</h3><p class="text-gray-500 group-hover:text-[#20BEFF] transition-colors text-xl">Data Science</p></div>
                            </div>
                        </a>
                    </div>
                </div>
            </section>

            <footer class="w-full py-16 px-6 md:px-12 border-t border-gray-200 dark:border-white/10 bg-white dark:bg-black text-gray-500 flex flex-col md:flex-row justify-between items-center text-sm font-mono transition-colors duration-500 relative z-30">
                <p>&copy; 2025 MICHAEL QIU.</p>
                <div class="flex gap-8 mt-6 md:mt-0">
                    <a href="#home" class="hover:text-klein-blue transition-colors">BACK TO TOP</a>
                </div>
            </footer>
        </main>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted, watch, nextTick } = Vue;

        // --- Perlin Noise Implementation (Self-contained) ---
        class Noise {
            constructor(seed) {
                this.grad3 = [[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];
                this.p = [];
                for (var i=0; i<256; i++) { this.p[i] = Math.floor(Math.random()*256); }
                this.perm = []; 
                for(var i=0; i<512; i++) { this.perm[i]=this.p[i & 255]; }
            }
            dot(g, x, y) { return g[0]*x + g[1]*y; }
            mix(a, b, t) { return (1-t)*a + t*b; }
            fade(t) { return t*t*t*(t*(t*6-15)+10); }
            perlin2(x, y) {
                var X = Math.floor(x), Y = Math.floor(y);
                x = x - X; y = y - Y;
                X = X & 255; Y = Y & 255;
                var n00 = this.dot(this.grad3[this.perm[X+this.perm[Y]] % 12], x, y);
                var n01 = this.dot(this.grad3[this.perm[X+this.perm[Y+1]] % 12], x, y-1);
                var n10 = this.dot(this.grad3[this.perm[X+1+this.perm[Y]] % 12], x-1, y);
                var n11 = this.dot(this.grad3[this.perm[X+1+this.perm[Y+1]] % 12], x-1, y-1);
                var u = this.fade(x); return this.mix(this.mix(n00, n10, u), this.mix(n01, n11, u), this.fade(y));
            }
        }

        // --- Wave Component Class ---
        class AWaves extends HTMLElement {
            connectedCallback() {
                this.svg = this.querySelector('.js-svg');
                if (!this.svg) {
                    this.svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    this.svg.classList.add("js-svg");
                    this.appendChild(this.svg);
                }

                this.mouse = {
                    x: -10, y: 0, lx: 0, ly: 0, sx: 0, sy: 0, v: 0, vs: 0, a: 0, set: false
                };

                this.lines = [];
                this.paths = [];
                this.noise = new Noise(Math.random());
                
                // Controlled by GSAP
                this.amplitude = 0; 

                this.setSize();
                this.setLines();
                this.bindEvents();
                this.rafId = requestAnimationFrame(this.tick.bind(this));
            }

            disconnectedCallback() {
                cancelAnimationFrame(this.rafId);
                window.removeEventListener('resize', this.onResize);
                window.removeEventListener('mousemove', this.onMouseMove);
            }

            bindEvents() {
                this.onResize = this.onResize.bind(this);
                this.onMouseMove = this.onMouseMove.bind(this);
                window.addEventListener('resize', this.onResize);
                window.addEventListener('mousemove', this.onMouseMove);
                this.addEventListener('touchmove', this.onTouchMove.bind(this));
            }

            onResize() {
                this.setSize();
                this.setLines();
            }

            onMouseMove(e) {
                this.updateMousePosition(e.clientX, e.clientY);
            }

            onTouchMove(e) {
                e.preventDefault();
                const touch = e.touches[0];
                this.updateMousePosition(touch.clientX, touch.clientY);
            }

            updateMousePosition(x, y) {
                const rect = this.getBoundingClientRect();
                this.mouse.x = x - rect.left;
                this.mouse.y = y - rect.top;

                if (!this.mouse.set) {
                    this.mouse.sx = this.mouse.x;
                    this.mouse.sy = this.mouse.y;
                    this.mouse.lx = this.mouse.x;
                    this.mouse.ly = this.mouse.y;
                    this.mouse.set = true;
                }
            }

            setSize() {
                this.bounding = this.getBoundingClientRect();
                this.svg.style.width = `${this.bounding.width}px`;
                this.svg.style.height = `${this.bounding.height}px`;
            }

            setLines() {
                const { width, height } = this.bounding;
                this.lines = [];
                this.paths.forEach(p => p.remove());
                this.paths = [];
                
                const xGap = 10; 
                const yGap = 32; 

                const oWidth = width + 200;
                const oHeight = height + 30;
                const totalLines = Math.ceil(oWidth / xGap);
                const totalPoints = Math.ceil(oHeight / yGap);
                const xStart = (width - xGap * totalLines) / 2;
                const yStart = (height - yGap * totalPoints) / 2;

                for (let i = 0; i <= totalLines; i++) {
                    const points = [];
                    for (let j = 0; j <= totalPoints; j++) {
                        points.push({ 
                            x: xStart + xGap * i, 
                            y: yStart + yGap * j, 
                            wave: { x: 0, y: 0 }, 
                            cursor: { x: 0, y: 0, vx: 0, vy: 0 } 
                        });
                    }
                    
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    path.classList.add('a__line');
                    path.classList.add('js-line');
                    
                    this.svg.appendChild(path);
                    this.paths.push(path);
                    this.lines.push(points);
                }
            }

            movePoints(time) {
                const { lines, mouse, noise } = this;
                const amp = this.amplitude; // Use dynamic amplitude controlled by GSAP

                lines.forEach((points) => {
                    points.forEach((p) => {
                        const move = noise.perlin2((p.x + time * 0.0125) * 0.002, (p.y + time * 0.005) * 0.0015) * 12;
                        p.wave.x = Math.cos(move) * 32 * amp;
                        p.wave.y = Math.sin(move) * 16 * amp;

                        const dx = p.x - mouse.sx;
                        const dy = p.y - mouse.sy;
                        const d = Math.hypot(dx, dy);
                        const l = Math.max(175, mouse.vs);

                        if (d < l) {
                            const s = 1 - d / l;
                            const f = Math.cos(d * 0.001) * s;
                            p.cursor.vx += Math.cos(mouse.a) * f * l * mouse.vs * 0.00065;
                            p.cursor.vy += Math.sin(mouse.a) * f * l * mouse.vs * 0.00065;
                        }

                        p.cursor.vx += (0 - p.cursor.x) * 0.005; 
                        p.cursor.vy += (0 - p.cursor.y) * 0.005;
                        p.cursor.vx *= 0.925; 
                        p.cursor.vy *= 0.925;
                        p.cursor.x += p.cursor.vx * 2; 
                        p.cursor.y += p.cursor.vy * 2;
                        
                        p.cursor.x = Math.min(100, Math.max(-100, p.cursor.x)); 
                        p.cursor.y = Math.min(100, Math.max(-100, p.cursor.y));
                    });
                });
            }

            moved(point, withCursorForce = true) {
                return {
                    x: Math.round((point.x + point.wave.x + (withCursorForce ? point.cursor.x : 0)) * 10) / 10,
                    y: Math.round((point.y + point.wave.y + (withCursorForce ? point.cursor.y : 0)) * 10) / 10
                };
            }

            drawLines() {
                const { lines, moved, paths } = this;
                lines.forEach((points, lIndex) => {
                    let p1 = moved(points[0], false);
                    let d = `M ${p1.x} ${p1.y}`;
                    
                    points.forEach((p1, pIndex) => {
                        const isLast = pIndex === points.length - 1;
                        p1 = moved(p1, !isLast);
                        d += `L ${p1.x} ${p1.y}`;
                    });
                    paths[lIndex].setAttribute('d', d);
                });
            }

            tick(time) {
                const { mouse } = this;
                
                mouse.sx += (mouse.x - mouse.sx) * 0.1;
                mouse.sy += (mouse.y - mouse.sy) * 0.1;
                
                const dx = mouse.x - mouse.lx;
                const dy = mouse.y - mouse.ly;
                const d = Math.hypot(dx, dy);
                
                mouse.v = d;
                mouse.vs += (d - mouse.vs) * 0.1;
                mouse.vs = Math.min(100, mouse.vs);
                
                mouse.lx = mouse.x; 
                mouse.ly = mouse.y;
                mouse.a = Math.atan2(dy, dx);
                
                this.style.setProperty('--x', `${mouse.sx}px`);
                this.style.setProperty('--y', `${mouse.sy}px`);
                
                this.movePoints(time);
                this.drawLines();
                
                this.rafId = requestAnimationFrame(this.tick.bind(this));
            }
        }
        if(!customElements.get('a-waves')) { customElements.define('a-waves', AWaves); }

        createApp({
            setup() {
                const isSidebarOpen = ref(false);
                const themeMode = ref('auto'); 
                const activeTheme = ref('dark'); 
                const scrollProgress = ref(0);
                const activeSection = ref('home');
                const isCapsuleOpen = ref(false);
                const loader = ref(null);
                const canvasContainer = ref(null);
                const photosWrapper = ref(null);
                const isBooting = ref(true);
                
                const navLeftColor = ref('text-white');
                const navCapsuleColor = ref('text-white');
                const navRightColor = ref('text-white');
                
                const navBtnLeft = ref(null);
                const navCapsule = ref(null);
                const navBtnRight = ref(null);

                // Camera Interaction Refs
                const photosActive = ref(false);
                const flashOverlay = ref(null);
                const cameraBtn = ref(null);
                let photosTimeline = null; // Store main timeline ref
                
                const systemLinks = [
                    { name: 'HOME' }, { name: 'WRITINGS' }, { name: 'ARCHIVE' }, { name: 'LABS' }
                ];
                
                const apps = [
                    { id: 'DesktopRenamer', name: 'DesktopRenamer', desc: 'Customizes the name of your current desktop in the menubar.', img: 'https://raw.githubusercontent.com/gitmichaelqiu/MyWebsite/refs/heads/main/resources/DesktopRenamer.png' },
                    { id: 'OptClick', name: 'OptClicker', desc: 'Simulate right-click via Option key.', img: 'https://raw.githubusercontent.com/gitmichaelqiu/MyWebsite/refs/heads/main/resources/OptClicker.png' },
                    { id: 'SpaceSwitcher', name: 'SpaceSwitcher', desc: 'Control app visibility across specific workspaces.', img: 'https://raw.githubusercontent.com/gitmichaelqiu/MyWebsite/refs/heads/main/resources/SpaceSwitcher.png' }
                ];

                const photos = [
                    { url: 'https://images.unsplash.com/photo-1480796927426-f609979314bd?q=80&w=1000&auto=format&fit=crop', title: 'Urban Geometry', date: 'TOKYO, 2023' },
                    { url: 'https://images.unsplash.com/photo-1511818966892-d7d671e672a2?q=80&w=1000&auto=format&fit=crop', title: 'Structures', date: 'SEOUL, 2024' },
                    { url: 'https://images.unsplash.com/photo-1493246507139-91e8fad9978e?q=80&w=1000&auto=format&fit=crop', title: 'Mountain Path', date: 'ALPS, 2023' },
                    { url: 'https://images.unsplash.com/photo-1506157786151-b8491531f063?q=80&w=1000&auto=format&fit=crop', title: 'Concert Hall', date: 'VIENNA, 2022' },
                    { url: 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?q=80&w=1000&auto=format&fit=crop', title: 'City Lights', date: 'CHICAGO, 2024' }
                ];

                let scene, camera, renderer, appsGroup;
                let icons = []; 
                let mouseX = 0, mouseY = 0;
                let lenis;
                let ballsRef = []; 

                const capsulePerimeter = 360; 
                const capsuleDashOffset = computed(() => {
                    const progress = Math.min(100, Math.max(0, scrollProgress.value));
                    return Math.max(0, capsulePerimeter - (progress / 100) * capsulePerimeter);
                });

                const toggleCapsuleNav = () => { isCapsuleOpen.value = !isCapsuleOpen.value; };
                const toggleSidebar = () => { isSidebarOpen.value = !isSidebarOpen.value; };

                watch(isSidebarOpen, (newVal) => { if (newVal) nextTick(() => lucide.createIcons()); });

                const resolveTheme = () => {
                    let resolved = 'dark';
                    if (themeMode.value === 'auto') {
                        resolved = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                    } else {
                        resolved = themeMode.value;
                    }
                    activeTheme.value = resolved;
                    if (resolved === 'dark') document.documentElement.classList.add('dark');
                    else document.documentElement.classList.remove('dark');
                };

                const cycleTheme = () => {
                    if (themeMode.value === 'auto') themeMode.value = 'light';
                    else if (themeMode.value === 'light') themeMode.value = 'dark';
                    else themeMode.value = 'auto';
                    resolveTheme();
                };

                const getLuminance = (colorStr) => {
                    const canvas = document.createElement("canvas");
                    canvas.width = 1; canvas.height = 1;
                    const ctx = canvas.getContext("2d");
                    ctx.fillStyle = colorStr;
                    ctx.fillRect(0, 0, 1, 1);
                    const [r, g, b] = ctx.getImageData(0, 0, 1, 1).data;
                    return 0.2126 * r + 0.7152 * g + 0.0722 * b;
                };

                const checkElementContrast = (el) => {
                    if (!el) return 'text-white';
                    const rect = el.getBoundingClientRect();
                    const x = rect.left + rect.width / 2;
                    const y = rect.top + rect.height / 2;
                    const elements = document.elementsFromPoint(x, y);
                    let bgLuminance = 0; 
                    
                    for (let e of elements) {
                        if (e.tagName === 'NAV' || e.closest('nav') || e.classList.contains('cursor-dot') || e.classList.contains('cursor-outline')) continue;
                        const style = window.getComputedStyle(e);
                        const bgColor = style.backgroundColor;
                        if (bgColor === 'rgba(0, 0, 0, 0)' || bgColor === 'transparent') continue;
                        bgLuminance = getLuminance(bgColor);
                        break;
                    }
                    return bgLuminance > 128 ? 'text-black' : 'text-white';
                };

                const updateNavColors = () => {
                    navLeftColor.value = checkElementContrast(navBtnLeft.value);
                    navCapsuleColor.value = checkElementContrast(navCapsule.value);
                    navRightColor.value = checkElementContrast(navBtnRight.value);
                };

                const updateScrollProgress = () => {
                    const scrollTop = window.scrollY || document.documentElement.scrollTop;
                    const docHeight = document.documentElement.scrollHeight;
                    const winHeight = window.innerHeight;
                    const scrollTotal = docHeight - winHeight;
                    
                    let progress = scrollTotal > 0 ? (scrollTop / scrollTotal) * 100 : 0;
                    progress = Math.min(100, Math.max(0, progress));
                    scrollProgress.value = progress;
                    
                    window.lastScrollY = scrollTop;

                    if (scrollTop < winHeight * 0.5) {
                        activeSection.value = 'home';
                    } else {
                        const sections = ['home', 'profile', 'works', 'photos', 'connect'];
                        for (const section of sections) {
                            const el = document.getElementById(section);
                            if (el) {
                                const rect = el.getBoundingClientRect();
                                if (rect.top <= winHeight * 0.5 && rect.bottom >= winHeight * 0.5) {
                                    activeSection.value = section;
                                }
                            }
                        }
                    }
                    updateNavColors();
                    
                    const magContainer = document.getElementById('magnetic-container');
                    const heroText = document.querySelector('.hero-text-container');
                    const introText = document.querySelector('.intro-text');
                    const creativeBanner = document.getElementById('creative-banner');
                    const tempUnderline = document.getElementById('temp-underline');
                    
                    if (scrollTop < winHeight * 3.5) {
                        if(magContainer && !isBooting.value) {
                            const fadeProgress = Math.min(1, scrollTop / (winHeight * 0.8));
                            magContainer.style.opacity = Math.max(0.1, 1 - fadeProgress); 
                            magContainer.style.transform = `scale(${1 - fadeProgress * 0.1})`; 
                        }
                        if(heroText) {
                            const moveProgress = Math.min(1, scrollTop / (winHeight * 1.5)); 
                            const targetY = -winHeight * 0.45 * moveProgress; 
                            const targetScale = 1 + (moveProgress * 0.3); 
                            heroText.style.transform = `translateY(${targetY}px) scale(${targetScale})`;
                            if(introText) {
                                if (moveProgress > 0.8) {
                                    const textFade = (moveProgress - 0.8) / 0.2;
                                    introText.style.opacity = textFade;
                                } else {
                                    introText.style.opacity = 0;
                                }
                            }
                            if(tempUnderline) {
                                tempUnderline.style.opacity = Math.max(0, 1 - moveProgress * 1.5);
                            }
                        }
                    }

                    if(creativeBanner) {
                        const bannerRect = document.getElementById('creative-banner').parentNode.getBoundingClientRect();
                        const triggerPoint = winHeight * 0.8; 
                        
                        if(bannerRect.top < triggerPoint && bannerRect.bottom > 0) {
                            const progress = 1 - (bannerRect.top / triggerPoint);
                            const scale = 0.5 + Math.max(0, progress) * 0.5; 
                            creativeBanner.style.transform = `scale(${scale})`;
                            creativeBanner.style.opacity = Math.min(1, progress * 1.5);
                        }
                    }
                };

                const initCursor = () => {
                    const dot = document.querySelector('.cursor-dot');
                    const outline = document.querySelector('.cursor-outline');
                    if(dot && outline) {
                        window.addEventListener('mousemove', (e) => {
                            const posX = e.clientX;
                            const posY = e.clientY;
                            dot.style.left = `${posX}px`; 
                            dot.style.top = `${posY}px`;
                            outline.animate({ left: `${posX}px`, top: `${posY}px` }, { duration: 500, fill: "forwards" });
                        });
                    }
                };

                const initMagneticLogo = () => {
                    const container = document.getElementById('magnetic-container');
                    if (!container) return;
                    if(ballsRef.length > 0) { gsap.ticker.remove(rotateBalls); ballsRef = []; container.innerHTML = ''; }
                    const logoPaths = [
                        "M443.24,16.93l-149.03,273.93c-3.34,6.14-5.12,13.33-5.12,20.68v145.02c0,20.73,13.85,37.54,30.94,37.54h149.03c17.09,0,30.94-16.81,30.94-37.54V37.61c0-37.23-39.85-51.75-56.75-20.68Z",
                        "M232.72,17.08L5.16,435.89c-13.56,24.96,1.19,58.2,25.83,58.2H167.51c10.4,0,20.1-6.34,25.83-16.88l91.04-167.55c3.33-6.13,5.11-13.32,5.11-20.66V37.74c0-37.24-39.87-51.75-56.76-20.66Z",
                        "M841.59,437.09l-178.07-239.47c-7.36-9.89-19.53-15.81-32.53-15.81h-60.8c-21.79,0-39.45,16.3-39.45,36.4v239.47c0,20.11,17.66,36.4,39.45,36.4h238.88c31.75,0,50.49-32.84,32.53-57Z",
                        "M693.68,164.05l86.8-117.52c13.58-18.38,.45-44.39-22.4-44.39h-173.6c-22.85,0-35.98,26.01-22.4,44.39l86.8,117.52c11.13,15.07,33.67,15.07,44.8,0Z"
                    ];
                    const width = container.clientWidth;
                    const height = container.clientHeight;
                    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    svg.setAttribute("width", "100%");
                    svg.setAttribute("height", "100%");
                    svg.style.overflow = "visible";
                    container.appendChild(svg);
                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    const logoScale = Math.min(width, height) / 500 * 0.9; 
                    const offsetX = (width - 848.58 * logoScale) / 2;
                    const offsetY = (height - 494.09 * logoScale) / 2;
                    ctx.fillStyle = "black";
                    ctx.save();
                    ctx.translate(offsetX, offsetY);
                    ctx.scale(logoScale, logoScale);
                    logoPaths.forEach(pathD => { const p = new Path2D(pathD); ctx.fill(p); });
                    ctx.restore();
                    const step = 28; 
                    const mouseRadius = 150; 
                    let ballIndex = 0;
                    const circleRadius = Math.min(width, height) * 0.15;
                    const centerScreenX = width / 2;
                    const centerScreenY = height / 2;
                    for (let y = 0; y < height; y += step) {
                        for (let x = 0; x < width; x += step) {
                            const pixel = ctx.getImageData(x, y, 1, 1).data;
                            if (pixel[3] > 128) {
                                ballIndex++;
                                const ball = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                                ball.setAttribute("class", "text-white fill-current magnetic-ball");
                                ball.setAttribute("r", 5); 
                                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                                line.setAttribute("class", "text-white magnetic-ball-line");
                                svg.appendChild(line);
                                svg.appendChild(ball);
                                let initialX, initialY;
                                if (isBooting.value) {
                                    const angle = (ballIndex * 0.1) + (Math.random() * 0.5);
                                    const r = circleRadius + (Math.random() * 20 - 10);
                                    initialX = centerScreenX + Math.cos(angle) * r;
                                    initialY = centerScreenY + Math.sin(angle) * r;
                                    ball.loadAngle = angle;
                                    ball.loadRadius = r;
                                    ball.loadSpeed = 0.001 + Math.random() * 0.002;
                                    line.style.opacity = '0';
                                } else {
                                    initialX = x; initialY = y;
                                    line.style.opacity = '0.15';
                                }
                                ball.setAttribute("cx", initialX); ball.setAttribute("cy", initialY);
                                line.setAttribute("x1", initialX); line.setAttribute("y1", initialY);
                                line.setAttribute("x2", initialX); line.setAttribute("y2", initialY);
                                ballsRef.push({ 
                                    el: ball, line: line, ori_x: x, ori_y: y,
                                    loadAngle: ball.loadAngle, loadRadius: ball.loadRadius, loadSpeed: ball.loadSpeed
                                });
                            }
                        }
                    }
                    container.addEventListener('mousemove', (e) => {
                        if (isBooting.value) return; 
                        const rect = container.getBoundingClientRect();
                        const mouseX = e.clientX - rect.left;
                        const mouseY = e.clientY - rect.top;
                        ballsRef.forEach(ball => {
                            const dx = ball.ori_x - mouseX;
                            const dy = ball.ori_y - mouseY;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            if (dist < mouseRadius) {
                                const angle = Math.atan2(dy, dx);
                                const moveDist = ((mouseRadius - dist) / mouseRadius) * 60; 
                                const tx = ball.ori_x + Math.cos(angle) * moveDist;
                                const ty = ball.ori_y + Math.sin(angle) * moveDist;
                                if (ball.animater) ball.animater.kill();
                                ball.animater = gsap.timeline()
                                    .to(ball.el, { attr: { cx: tx, cy: ty }, duration: 0.3, ease: "power3.out" })
                                    .to(ball.line, { attr: { x2: tx, y2: ty }, duration: 0.3, ease: "power3.out" }, "<")
                                    .to(ball.el, { attr: { cx: ball.ori_x, cy: ball.ori_y }, duration: 1.0, ease: "elastic.out(1, 0.3)" }, ">0.05")
                                    .to(ball.line, { attr: { x2: ball.ori_x, y2: ball.ori_y }, duration: 1.0, ease: "elastic.out(1, 0.3)" }, "<");
                            }
                        });
                    });
                    if(isBooting.value) { gsap.ticker.add(rotateBalls); }
                };

                function rotateBalls(time, deltaTime, frame) {
                    if (!isBooting.value) return;
                    const container = document.getElementById('magnetic-container');
                    if(!container) return;
                    const centerX = container.clientWidth / 2;
                    const centerY = container.clientHeight / 2;
                    ballsRef.forEach(ball => {
                        ball.loadAngle += (ball.loadSpeed * deltaTime);
                        const x = centerX + Math.cos(ball.loadAngle) * ball.loadRadius;
                        const y = centerY + Math.sin(ball.loadAngle) * ball.loadRadius;
                        ball.el.setAttribute('cx', x);
                        ball.el.setAttribute('cy', y);
                    });
                }
                
                const finishBootSequence = () => {
                    isBooting.value = false;
                    gsap.ticker.remove(rotateBalls);
                    if(loader.value) {
                        gsap.to(loader.value, { opacity: 0, duration: 0.5, onComplete: () => { loader.value.style.display = 'none'; } });
                    }
                    ballsRef.forEach(ball => {
                        gsap.to(ball.el, { attr: { cx: ball.ori_x, cy: ball.ori_y }, duration: 1.6, ease: "power4.inOut", delay: Math.random() * 0.1 });
                        ball.line.setAttribute('x1', ball.ori_x); ball.line.setAttribute('y1', ball.ori_y);
                        ball.line.setAttribute('x2', ball.ori_x); ball.line.setAttribute('y2', ball.ori_y);
                        gsap.to(ball.line, { opacity: 0.15, duration: 1, delay: 1 });
                    });
                    gsap.to(".hero-text-container", { opacity: 1, duration: 2, ease: "power4.out", delay: 1.0 });
                };

                const createSquircleShape = (size) => {
                    const shape = new THREE.Shape();
                    const width = size; const height = size;
                    const x = -width / 2; const y = -height / 2;
                    const r = 0.7; 
                    shape.moveTo( x, y + r );
                    shape.lineTo( x, y + height - r );
                    shape.quadraticCurveTo( x, y + height, x + r, y + height );
                    shape.lineTo( x + width - r, y + height );
                    shape.quadraticCurveTo( x + width, y + height, x + width, y + height - r );
                    shape.lineTo( x + width, y + r );
                    shape.quadraticCurveTo( x + width, y, x + width - r, y );
                    shape.lineTo( x + r, y );
                    shape.quadraticCurveTo( x, y, x, y + r );
                    return shape;
                };

                const createFallbackTexture = (text) => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 2048; canvas.height = 2048; 
                    const ctx = canvas.getContext('2d');
                    ctx.fillStyle = '#050505';
                    ctx.fillRect(0, 0, 2048, 2048);
                    ctx.strokeStyle = '#222';
                    ctx.lineWidth = 10;
                    for(let i=0; i<2048; i+=256) {
                        ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, 2048); ctx.stroke();
                        ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(2048, i); ctx.stroke();
                    }
                    ctx.strokeStyle = '#002FA7';
                    ctx.lineWidth = 40;
                    ctx.beginPath();
                    if (ctx.roundRect) ctx.roundRect(80, 80, 1888, 1888, 300);
                    else ctx.rect(80, 80, 1888, 1888);
                    ctx.stroke();
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 600px "Inter", sans-serif'; 
                    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                    ctx.fillText(text.substring(0, 2).toUpperCase(), 1024, 1024);
                    const tex = new THREE.CanvasTexture(canvas);
                    tex.anisotropy = renderer.capabilities.getMaxAnisotropy();
                    return tex;
                };

                const initThreeJS = () => {
                    if (!canvasContainer.value) return;
                    const width = canvasContainer.value.clientWidth;
                    const height = canvasContainer.value.clientHeight;
                    scene = new THREE.Scene();
                    camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 100);
                    camera.position.z = 12;
                    renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                    renderer.setSize(width, height);
                    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                    renderer.toneMapping = THREE.ACESFilmicToneMapping;
                    renderer.toneMappingExposure = 1.2;
                    canvasContainer.value.appendChild(renderer.domElement);
                    appsGroup = new THREE.Group();
                    scene.add(appsGroup);
                    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5); 
                    scene.add(ambientLight);
                    const keyLight = new THREE.SpotLight(0xffffff, 2);
                    keyLight.position.set(-10, 10, 10);
                    scene.add(keyLight);
                    const backLight = new THREE.DirectionalLight(0x002FA7, 2);
                    backLight.position.set(0, 5, -10);
                    scene.add(backLight);
                    const size = 3; 
                    const extrudeSettings = { depth: 0.4, bevelEnabled: true, bevelSegments: 5, steps: 1, bevelSize: 0.05, bevelThickness: 0.05 };
                    const shape = createSquircleShape(size); 
                    const geometry = new THREE.ExtrudeGeometry(shape, extrudeSettings);
                    geometry.computeBoundingBox();
                    const max = geometry.boundingBox.max; const min = geometry.boundingBox.min;
                    const range = new THREE.Vector2(max.x - min.x, max.y - min.y);
                    const uvAttribute = geometry.attributes.uv; const posAttribute = geometry.attributes.position;
                    for (let i = 0; i < posAttribute.count; i++) {
                        const x = posAttribute.getX(i); const y = posAttribute.getY(i);
                        uvAttribute.setXY(i, (x - min.x) / range.x, (y - min.y) / range.y);
                    }
                    geometry.attributes.uv.needsUpdate = true;
                    geometry.center();
                    const texLoader = new THREE.TextureLoader();
                    apps.forEach((app, i) => {
                        const sideMaterial = new THREE.MeshPhysicalMaterial({ color: 0x001133, roughness: 0.2, metalness: 0.8 });
                        const frontMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.4, metalness: 0.1 });
                        texLoader.load(app.img, 
                            (texture) => {
                                texture.encoding = THREE.sRGBEncoding;
                                texture.anisotropy = renderer.capabilities.getMaxAnisotropy();
                                frontMaterial.map = texture;
                                frontMaterial.needsUpdate = true;
                            },
                            undefined,
                            () => {
                                const fallback = createFallbackTexture(app.name);
                                frontMaterial.map = fallback;
                                frontMaterial.needsUpdate = true;
                            }
                        );
                        const mesh = new THREE.Mesh(geometry, [frontMaterial, sideMaterial]);
                        mesh.position.set(0, -10, 0); 
                        appsGroup.add(mesh);
                        icons.push(mesh);
                    });
                    document.addEventListener('mousemove', (event) => {
                        mouseX = (event.clientX - window.innerWidth / 2) * 0.0005;
                        mouseY = (event.clientY - window.innerHeight / 2) * 0.0005;
                    });
                    window.addEventListener('resize', () => {
                        if(!canvasContainer.value) return;
                        const w = canvasContainer.value.clientWidth;
                        const h = canvasContainer.value.clientHeight;
                        camera.aspect = w / h;
                        camera.updateProjectionMatrix();
                        renderer.setSize(w, h);
                        initMagneticLogo();
                    });
                    const animate = () => {
                        requestAnimationFrame(animate);
                        icons.forEach((icon, i) => {
                            icon.rotation.x += 0.05 * (mouseY * 0.5 - icon.rotation.x);
                            icon.rotation.y += 0.05 * (mouseX * 0.5 - icon.rotation.y);
                        });
                        renderer.render(scene, camera);
                    };
                    animate();
                    const sections = document.querySelectorAll('.app-section');
                    sections.forEach((section, index) => {
                        ScrollTrigger.create({
                            trigger: section,
                            start: "top 75%",
                            end: "bottom 75%",
                            onEnter: () => animateIconIn(index),
                            onEnterBack: () => animateIconIn(index),
                            onLeave: () => animateIconOut(index, 1),
                            onLeaveBack: () => animateIconOut(index, -1)
                        });
                    });
                };

                const animateIconIn = (index) => {
                    const icon = icons[index];
                    if(!icon) return;
                    const isMobile = window.innerWidth < 768;
                    const targetX = isMobile ? 0 : -3.5; 
                    const targetY = isMobile ? 2.5 : 0; 
                    gsap.to(icon.position, { x: targetX, y: targetY, duration: 1.2, ease: "power3.out", overwrite: true });
                    gsap.to(icon.scale, { x: 1.1, y: 1.1, z: 1.1, duration: 1.2, ease: "elastic.out(1, 0.8)", overwrite: true });
                    gsap.to(icon.rotation, { x: 0, y: 0.2, z: 0, duration: 1.2, overwrite: true });
                };

                const animateIconOut = (index, direction) => {
                    const icon = icons[index];
                    if(!icon) return;
                    const targetY = direction > 0 ? 15 : -15; 
                    gsap.to(icon.position, { y: targetY, x: 0, duration: 0.8, ease: "power3.in", overwrite: true });
                    gsap.to(icon.scale, { x: 0.5, y: 0.5, z: 0.5, duration: 0.8, overwrite: true });
                };

                const initLenis = () => {
                    lenis = new Lenis({
                        duration: 2.0, 
                        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
                        direction: 'vertical',
                        gestureDirection: 'vertical',
                        smooth: true,
                        mouseMultiplier: 0.8,
                        smoothTouch: false,
                        touchMultiplier: 2,
                    });
                    function raf(time) {
                        lenis.raf(time);
                        ScrollTrigger.update();
                        requestAnimationFrame(raf);
                    }
                    requestAnimationFrame(raf);
                };

                // --- NEW: Camera Interaction Logic ---
                // We no longer trigger state here directly. We just scroll to the timeline point.
                const handleCaptureClick = () => {
                   if (!photosTimeline) return;
                   
                   // Find the start time of the capture label or approximation
                   // 25% of the total scroll distance of the pinned element
                   // The pinned element is #photos, duration is +=6000
                   const trigger = ScrollTrigger.getById("photos-trigger");
                   if(trigger) {
                       const start = trigger.start;
                       const end = trigger.end;
                       const distance = end - start;
                       // We want to scroll to 26% of the way through the trigger
                       const targetScroll = start + (distance * 0.26);
                       
                       gsap.to(window, {
                           scrollTo: targetScroll,
                           duration: 1.5,
                           ease: "power3.inOut"
                       });
                   }
                };

                onMounted(() => {
                    setTimeout(() => { finishBootSequence(); }, 2500);
                    initMagneticLogo();
                    lucide.createIcons();
                    resolveTheme(); 
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', resolveTheme);
                    initThreeJS();
                    initCursor();
                    initLenis(); 
                    window.addEventListener('scroll', updateScrollProgress);

                    // --- CONSOLIDATED PHOTOS TIMELINE ---
                    const waves = document.querySelector('a-waves');
                    const photoCards = document.querySelectorAll('.photo-card-vertical');
                    
                    photosTimeline = gsap.timeline({
                        scrollTrigger: {
                            id: "photos-trigger",
                            trigger: "#photos",
                            start: "top top",
                            end: "+=6000",
                            pin: true,
                            scrub: 1, // Smooth scrubbing
                            onUpdate: (self) => {
                                // Fallback logic if needed
                            }
                        }
                    });

                    // 1. Vines/Lines Grow (0% -> 10%)
                    photosTimeline.to("a-waves", { 
                        "--dash-offset": 0, 
                        duration: 10, 
                        ease: "power2.inOut"
                    });

                    // 2. HUD Appears (10% -> 20%)
                    photosTimeline.to(".camera-hud", { opacity: 1, duration: 10 });

                    // 3. User Decision Window (Wait) (20% -> 25%)
                    photosTimeline.to({}, { duration: 5 }); 

                    // 4. THE CAPTURE MOMENT (25%)
                    photosTimeline.addLabel("capture");
                    
                    // Flash: Fast flash then fade
                    photosTimeline.to(flashOverlay.value, { opacity: 1, duration: 0.5, ease: "power4.in" }, "capture");
                    photosTimeline.to(flashOverlay.value, { opacity: 0, duration: 2, ease: "power4.out" }, "capture+=0.5");
                    
                    // Distortion: Amplitude spikes then settles
                    if (waves) {
                        photosTimeline.to(waves, { amplitude: 1, duration: 2, ease: "elastic.out(1, 0.3)" }, "capture");
                    }
                    
                    // HUD Disappears
                    photosTimeline.to(".camera-hud", { opacity: 0, pointerEvents: "none", duration: 2 }, "capture");

                    // 5. State Change Logic (Using callbacks to ensure it reverses properly)
                    photosTimeline.call(() => {
                        // Forward direction: Active
                        photosActive.value = true;
                    }, null, "capture+=0.1");

                    // Need a way to reset when going back BEFORE capture
                    // We insert a callback slightly before the capture point
                    photosTimeline.call(() => {
                         // Check direction, if we are reversing past this point
                         if (photosTimeline.scrollTrigger.direction < 0) {
                             photosActive.value = false;
                             // Reset amplitude on reverse if scrubbing doesn't catch it perfectly
                             if(waves) waves.amplitude = 0; 
                         }
                    }, null, "capture-=0.1");

                    // 6. Title Reveal (Shutter Open)
                    photosTimeline.to(".gallery-title", { 
                        scaleY: 1, 
                        scale: 1, 
                        filter: "blur(0px)",
                        clipPath: "inset(0 0 0 0)", 
                        opacity: 1,
                        duration: 5, 
                        ease: "power2.out" 
                    }, "capture+=0.5");

                    // 7. Transition to Quote (The Ghost Effect)
                    // Title blurs and fades out to become a background element
                    photosTimeline.to(".gallery-title", { 
                        opacity: 0.1, 
                        filter: "blur(10px)",
                        scale: 1.05,
                        duration: 5,
                        ease: "power1.inOut"
                    }, "+=1"); // Short pause after title reveal

                    // Quote fades in simultaneously
                    photosTimeline.to(".gallery-quote", { 
                        opacity: 1, 
                        y: 0, // Ensure it settles
                        duration: 5,
                        ease: "power1.out"
                    }, "<"); 

                    // 8. Transition to Grid (40% -> 50%)
                    photosTimeline.to(".gallery-quote", { opacity: 0, y: -50, duration: 5 }, "+=2");
                    photosTimeline.to(".gallery-title", { opacity: 0, y: -100, duration: 5 }, "<");
                    
                    // 9. Grid Entry (50% -> 60%)
                    photosTimeline.to(".photos-grid", { 
                        y: 0, 
                        opacity: 1, 
                        duration: 10, 
                        ease: "power3.out" 
                    });

                    // 10. Staggered Card Entries (Embedded in timeline)
                    // We animate them IN as the grid moves up
                    photoCards.forEach((card, index) => {
                        // Offset the start time for staggering
                        const offset = index * 2; 
                        photosTimeline.fromTo(card, 
                            { opacity: 0, y: 100 },
                            { opacity: 1, y: 0, duration: 5, ease: "power3.out" },
                            `>-${8 - offset}` // Overlap with grid entry
                        );
                    });

                    // 11. Grid Scroll (60% -> 90%)
                    photosTimeline.to(".photos-grid", {
                        y: "-50%", 
                        duration: 30,
                        ease: "none" 
                    });

                    // 12. Exit (90% -> 100%)
                    photosTimeline.to(".photos-grid", {
                        y: "-150%", 
                        opacity: 0,
                        filter: "blur(20px)",
                        scale: 0.8,
                        duration: 10,
                        ease: "power4.in"
                    });

                });
                
                onUnmounted(() => {
                    window.removeEventListener('scroll', updateScrollProgress);
                    window.matchMedia('(prefers-color-scheme: dark)').removeEventListener('change', resolveTheme);
                    if(lenis) lenis.destroy();
                    gsap.ticker.remove(rotateBalls);
                });

                return {
                    isSidebarOpen, themeMode, activeTheme, scrollProgress, activeSection, isCapsuleOpen, capsulePerimeter, capsuleDashOffset, toggleSidebar, toggleCapsuleNav, cycleTheme, loader, canvasContainer, apps, systemLinks, photos, photosWrapper,
                    navLeftColor, navCapsuleColor, navRightColor, navCapsule, navBtnLeft, navBtnRight,
                    photosActive, handleCaptureClick, flashOverlay, cameraBtn
                };
            }
        }).mount('#app');
    </script>
</body>
</html>